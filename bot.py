import os
import logging
import re
from typing import Dict, Optional, Set, Any, List, Tuple
import asyncio
import json
import openai
import random # Ğ”Ğ»Ñ Ğ²Ğ°Ñ€Ğ¸Ğ°Ñ†Ğ¸Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, CallbackQuery, ReactionTypeEmoji
from telegram.constants import ParseMode, ChatActionÂ 
from telegram.ext import (
Â  Â  ApplicationBuilder,
Â  Â  CommandHandler,
Â  Â  CallbackQueryHandler,
Â  Â  MessageHandler,
Â  Â  ContextTypes,
Â  Â  filters,
Â  Â  JobQueue,
Â  Â  ConversationHandler,
)
from telegram.error import TelegramError
from datetime import datetime, timedelta
from logging.handlers import RotatingFileHandler

# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ---
logging.basicConfig(
Â  Â  level=logging.INFO,
Â  Â  format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
Â  Â  handlers=[
Â  Â  Â  Â  RotatingFileHandler("bot.log", maxBytes=5 * 1024 * 1024, backupCount=3, encoding='utf-8'),
Â  Â  Â  Â  logging.StreamHandler()
Â  Â  ]
)
logger = logging.getLogger(__name__)

# --- ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ ---
CONFIG = {
Â  Â  "ADMIN_IDS": [7611426172],Â 
Â  Â  "DELAY_SECONDS_MAIN_SERVICE": 7200,Â 
Â  Â  # "DELAY_SECONDS_MAIN_SERVICE": 10, # Ğ¢ĞµÑÑ‚
Â  Â  "DELAY_SECONDS_REVIEW_REQUEST": 43200,Â 
Â  Â  # "DELAY_SECONDS_REVIEW_REQUEST": 20, # Ğ¢ĞµÑÑ‚
Â  Â  "MAX_MESSAGE_LENGTH": 3900,
Â  Â  "OPENAI_MAX_TOKENS_TAROT": 4000,
Â  Â  "OPENAI_MAX_TOKENS_MATRIX": 6000,
Â  Â  "OPENAI_MAX_CONCURRENT": 3,
Â  Â  "RETRY_DELAY": 7,
Â  Â  "MAX_RETRIES": 2,
Â  Â  "COMPLETED_USERS_FILE": "completed_users.json",
Â  Â  "MIN_TEXT_LENGTH_TAROT_BACKSTORY": 30,Â 
Â  Â  "MIN_TEXT_LENGTH_TAROT_QUESTION": 10,Â 
}

# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° API ---
openai.api_key = os.getenv("OPENAI_API_KEY")
BOT_TOKEN = os.getenv("TELEGRAM_TOKEN")

if not BOT_TOKEN or not openai.api_key:
Â  Â  logger.critical("ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ TELEGRAM_TOKEN Ğ¸Ğ»Ğ¸ OPENAI_API_KEY.")
Â  Â  raise ValueError("Ğ¢Ğ¾ĞºĞµĞ½Ñ‹ TELEGRAM_TOKEN Ğ¸ OPENAI_API_KEY Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹.")
logger.info("Ğ¢Ğ¾ĞºĞµĞ½Ñ‹ Ğ±Ğ¾Ñ‚Ğ° Ğ¸ OpenAI Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ñ‹.")

# --- Ğ¥Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (completed_users) ---
completed_users: Set[int] = set()

def load_completed_users() -> Set[int]:
Â  Â  try:
Â  Â  Â  Â  if os.path.exists(CONFIG["COMPLETED_USERS_FILE"]):
Â  Â  Â  Â  Â  Â  with open(CONFIG["COMPLETED_USERS_FILE"], 'r', encoding='utf-8') as f:
Â  Â  Â  Â  Â  Â  Â  Â  user_ids = json.load(f)
Â  Â  Â  Â  Â  Â  Â  Â  logger.info(f"Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¾ {len(user_ids)} Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¸Ğ· {CONFIG['COMPLETED_USERS_FILE']}")
Â  Â  Â  Â  Â  Â  Â  Â  return set(user_ids)
Â  Â  except Exception as e:
Â  Â  Â  Â  logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ {CONFIG['COMPLETED_USERS_FILE']}: {e}")
Â  Â  return set()

def save_completed_users(users_set: Set[int]):
Â  Â  try:
Â  Â  Â  Â  with open(CONFIG["COMPLETED_USERS_FILE"], 'w', encoding='utf-8') as f:
Â  Â  Â  Â  Â  Â  json.dump(list(users_set), f, indent=4)
Â  Â  Â  Â  logger.info(f"Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº {len(users_set)} Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½ Ğ² {CONFIG['COMPLETED_USERS_FILE']}")
Â  Â  except Exception as e:
Â  Â  Â  Â  logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ {CONFIG['COMPLETED_USERS_FILE']}: {e}")

completed_users = load_completed_users()


# === Ğ¢ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğµ ĞºĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹ ===
WELCOME_TEXT = """
Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ! âœ¨ Ğ Ğ°Ğ´Ğ° Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼ÑÑ‚Ğ²Ñƒ, Ğ¼ĞµĞ½Ñ Ğ·Ğ¾Ğ²ÑƒÑ‚ Ğ—Ğ°Ğ¼Ğ¸Ñ€Ğ°.
Ğ¯ Ñ‚Ğ°Ñ€Ğ¾Ğ»Ğ¾Ğ³ Ğ¸ ÑĞ·Ğ¾Ñ‚ĞµÑ€Ğ¸Ğº, Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ Ğ»ÑĞ´ÑĞ¼ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ Ğ¸ Ñ€Ğ°Ğ·Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒÑÑ Ğ² ÑĞµĞ±Ğµ ÑƒĞ¶Ğµ Ğ±Ğ¾Ğ»ĞµĞµ 15 Ğ»ĞµÑ‚.

Ğ—Ğ´ĞµÑÑŒ Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚ Ğ¼ĞµĞ½Ñ Ğ¾Ğ´Ğ½Ñƒ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½ÑƒÑ ÑƒÑĞ»ÑƒĞ³Ñƒ:
ğŸƒ Ğ Ğ°ÑĞºĞ»Ğ°Ğ´ Ğ½Ğ° ĞºĞ°Ñ€Ñ‚Ğ°Ñ… Ğ¢Ğ°Ñ€Ğ¾
ğŸŒŸ Ğ Ğ°Ğ·Ğ±Ğ¾Ñ€ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ Ğ¡ÑƒĞ´ÑŒĞ±Ñ‹

Ğ’ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğµ ÑĞ½ĞµÑ€Ğ³Ğ¾Ğ¾Ğ±Ğ¼ĞµĞ½Ğ° Ğ¿Ğ¾ÑĞ»Ğµ ĞºĞ¾Ğ½ÑÑƒĞ»ÑŒÑ‚Ğ°Ñ†Ğ¸Ğ¸ Ñ Ğ¿Ñ€Ğ¾ÑˆÑƒ Ğ»Ğ¸ÑˆÑŒ Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ·Ñ‹Ğ² Ğ¾ Ğ¼Ğ¾ĞµĞ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ Ğ½Ğ° ĞĞ²Ğ¸Ñ‚Ğ¾.

ĞšĞ°Ğº ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚?
1.Â  ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ /start (ĞµÑĞ»Ğ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ğ»Ğ¸, Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾!).
2.Â  Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ½Ğ¸Ğ¶Ğµ, Ñ‡Ñ‚Ğ¾ Ğ²Ğ°Ñ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑÑƒĞµÑ‚: Ğ¢Ğ°Ñ€Ğ¾ Ğ¸Ğ»Ğ¸ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ğ°.
3.Â  Ğ¯ Ğ·Ğ°Ğ´Ğ°Ğ¼ Ğ²Ğ°Ğ¼ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ¸.
4.Â  ĞÑ‚Ğ²ĞµÑ‚ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ 2-3 Ñ‡Ğ°ÑĞ¾Ğ², Ñ‚Ğ°Ğº ĞºĞ°Ğº ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ Ñ€Ğ°Ğ·Ğ±Ğ¸Ñ€Ğ°Ñ Ğ»Ğ¸Ñ‡Ğ½Ğ¾.

Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ñ‹ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ? Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑƒÑĞ»ÑƒĞ³Ñƒ ğŸ‘‡
"""

TAROT_INTRO_TEXT = "ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! Ğ’Ñ‹ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ»Ğ¸ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´ Ğ½Ğ° Ğ¢Ğ°Ñ€Ğ¾. ğŸƒ\nĞ§Ñ‚Ğ¾Ğ±Ñ‹ Ñ Ğ¼Ğ¾Ğ³Ğ»Ğ° ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ´Ğ»Ñ Ğ²Ğ°Ñ Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ¸ Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¸Ğ¹ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´, Ğ¼Ğ½Ğµ Ğ¿Ğ¾Ğ½Ğ°Ğ´Ğ¾Ğ±Ğ¸Ñ‚ÑÑ Ğ½ĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ. Ğ¯ Ğ±ÑƒĞ´Ñƒ Ğ·Ğ°Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¿Ğ¾ ÑˆĞ°Ğ³Ğ°Ğ¼."
MATRIX_INTRO_TEXT = "ĞŸÑ€ĞµĞºÑ€Ğ°ÑĞ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€! Ğ Ğ°Ğ·Ğ±Ğ¾Ñ€ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ Ğ¡ÑƒĞ´ÑŒĞ±Ñ‹ â€” ÑÑ‚Ğ¾ Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¾Ğµ Ğ¿Ğ¾Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ Ğ² Ğ²Ğ°Ñˆ Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ». ğŸŒŸ\nĞ”Ğ»Ñ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ° Ğ¼Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ñ‹ Ğ±ÑƒĞ´ÑƒÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ğ°ÑˆĞµ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ Ğ¸Ğ¼Ñ Ğ¸ Ğ´Ğ°Ñ‚Ğ° Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ. Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ Ğ²ÑÑ‘ ÑĞ¿Ñ€Ğ¾ÑˆÑƒ."

ASK_MATRIX_NAME_TEXT = "(Ğ¨Ğ°Ğ³ 1 Ğ¸Ğ· 2) ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ²Ğ°ÑˆĞµ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ Ğ¸Ğ¼Ñ (Ğ¸Ğ»Ğ¸ Ğ¸Ğ¼Ñ Ñ‚Ğ¾Ğ³Ğ¾, Ğ´Ğ»Ñ ĞºĞ¾Ğ³Ğ¾ Ğ´ĞµĞ»Ğ°ĞµĞ¼ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€)."
ASK_MATRIX_DOB_TEXT = "(Ğ¨Ğ°Ğ³ 2 Ğ¸Ğ· 2) Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ´Ğ°Ñ‚Ñƒ Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ Ğ”Ğ”.ĞœĞœ.Ğ“Ğ“Ğ“Ğ“ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 25.07.1988)."
CONFIRM_DETAILS_MATRIX_TEXT = """
Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾! ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ Ğ¡ÑƒĞ´ÑŒĞ±Ñ‹:
Ğ˜Ğ¼Ñ: {name}
Ğ”Ğ°Ñ‚Ğ° Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ: {dob}

Ğ’ÑÑ‘ Ğ²ĞµÑ€Ğ½Ğ¾? Ğ•ÑĞ»Ğ¸ Ğ´Ğ°, Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Â«ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒÂ».
"""

ASK_TAROT_MAIN_PERSON_NAME_TEXT = "(Ğ¨Ğ°Ğ³ 1 Ğ¸Ğ· 5) Ğ”Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ°Ñ‡Ğ½ĞµĞ¼. ĞĞ° Ñ‡ÑŒĞµ Ğ¸Ğ¼Ñ Ğ±ÑƒĞ´ĞµĞ¼ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´ Ğ¢Ğ°Ñ€Ğ¾? ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğµ Ğ¸Ğ¼Ñ."
ASK_TAROT_MAIN_PERSON_DOB_TEXT = "(Ğ¨Ğ°Ğ³ 2 Ğ¸Ğ· 5) ĞŸĞ¾Ğ½ÑĞ»Ğ°, {name}. Ğ¢ĞµĞ¿ĞµÑ€ÑŒ ÑƒĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ´Ğ°Ñ‚Ñƒ Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ° Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ Ğ”Ğ”.ĞœĞœ.Ğ“Ğ“Ğ“Ğ“ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 12.08.1985)."
ASK_TAROT_BACKSTORY_TEXT = f"""
(Ğ¨Ğ°Ğ³ 3 Ğ¸Ğ· 5) ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾. Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚: Ğ¾Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ²Ğ°ÑˆÑƒ ÑĞ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ Ğ¸Ğ»Ğ¸ Ğ¿Ñ€ĞµĞ´Ñ‹ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ°.Â 
Ğ§Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ¾, Ñ‡Ñ‚Ğ¾ Ğ²Ğ°Ñ Ğ±ĞµÑĞ¿Ğ¾ĞºĞ¾Ğ¸Ñ‚ Ğ¸Ğ»Ğ¸ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑÑƒĞµÑ‚? Ğ§ĞµĞ¼ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½ĞµĞµ Ğ²Ñ‹ Ğ¾Ğ¿Ğ¸ÑˆĞµÑ‚Ğµ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ (Ñ…Ğ¾Ñ‚Ñ Ğ±Ñ‹ {CONFIG['MIN_TEXT_LENGTH_TAROT_BACKSTORY']} ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²), Ñ‚ĞµĞ¼ Ğ³Ğ»ÑƒĞ±Ğ¶Ğµ Ñ ÑĞ¼Ğ¾Ğ³Ñƒ Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ.
ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: Â«ĞœÑ‹ Ñ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ¾Ğ¼ ÑÑ‚Ğ°Ğ»Ğ¸ Ñ‡Ğ°ÑÑ‚Ğ¾ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ¼ĞµÑÑÑ†Ñ‹, Ğ½Ğµ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ñ, Ğ² Ñ‡ĞµĞ¼ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° Ğ¸ ĞºĞ°Ğº ÑÑ‚Ğ¾ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒÂ» Ğ¸Ğ»Ğ¸ Â«Ğ¡Ñ‚Ğ¾Ñ Ğ¿ĞµÑ€ĞµĞ´ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ¾Ğ¼ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹, ĞµÑÑ‚ÑŒ Ğ´Ğ²Ğ° Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ°, Ğ½Ğµ Ğ¼Ğ¾Ğ³Ñƒ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑÂ».
"""
ASK_TAROT_OTHER_PEOPLE_TEXT = """
(Ğ¨Ğ°Ğ³ 4 Ğ¸Ğ· 5) ĞŸĞ¾Ğ½ÑÑ‚Ğ½Ğ¾. Ğ•ÑÑ‚ÑŒ Ğ»Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ»ÑĞ´Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¸Ğ¼ĞµÑÑ‚ Ğ¿Ñ€ÑĞ¼Ğ¾Ğµ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ Ğº Ğ²Ğ°ÑˆĞµĞ¼Ñƒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑƒ?Â 
Ğ•ÑĞ»Ğ¸ Ğ´Ğ°, Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ¸Ñ… Ğ¸Ğ¼ĞµĞ½Ğ° Ğ¸, ĞµÑĞ»Ğ¸ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚ Ğ¸Ğ»Ğ¸ Ğ´Ğ°Ñ‚Ñƒ Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ. Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´ Ğ±Ğ¾Ğ»ĞµĞµ Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¼.
Ğ•ÑĞ»Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ»ÑĞ´ĞµĞ¹ Ğ½ĞµÑ‚, Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Â«Ğ½ĞµÑ‚Â» Ğ¸Ğ»Ğ¸ Â«Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ/Ğ¾Ğ½/Ğ¾Ğ½Ğ°Â».
ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: Â«Ğ”Ğ°, Ğ¼Ğ¾Ğ¹ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€ Ğ¡ĞµÑ€Ğ³ĞµĞ¹, 35 Ğ»ĞµÑ‚Â» Ğ¸Ğ»Ğ¸ Â«ĞĞµÑ‚, Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ±Ğ¾ Ğ¼Ğ½ĞµÂ».
"""
ASK_TAROT_QUESTIONS_TEXT = f"""
(Ğ¨Ğ°Ğ³ 5 Ğ¸Ğ· 5) Ğ˜ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ ÑˆĞ°Ğ³: ÑÑ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ²Ğ°Ñˆ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ (Ğ¸Ğ»Ğ¸ 2-3 Ñ‡ĞµÑ‚ĞºĞ¸Ñ… Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ°), Ğ½Ğ° ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ²Ñ‹ Ñ…Ğ¾Ñ‚ĞµĞ»Ğ¸ Ğ±Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ¾Ñ‚ ĞºĞ°Ñ€Ñ‚ Ğ¢Ğ°Ñ€Ğ¾.Â 
ĞŸĞ¾ÑÑ‚Ğ°Ñ€Ğ°Ğ¹Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ±Ñ‹Ğ»Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¼Ğ¸ Ğ¸ ĞºĞ°ÑĞ°Ğ»Ğ¸ÑÑŒ ÑÑƒÑ‚Ğ¸ Ğ²Ğ°ÑˆĞµĞ¹ ÑĞ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ğ¸ (Ñ…Ğ¾Ñ‚Ñ Ğ±Ñ‹ {CONFIG['MIN_TEXT_LENGTH_TAROT_QUESTION']} ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ).
ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: Â«ĞšĞ°ĞºĞ¸Ğµ Ğ¿ĞµÑ€ÑĞ¿ĞµĞºÑ‚Ğ¸Ğ²Ñ‹ Ñƒ Ğ¼Ğ¾Ğ¸Ñ… Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğ¹ Ñ Ğ¡ĞµÑ€Ğ³ĞµĞµĞ¼ Ğ² Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞ¸Ğµ Ğ¿Ğ¾Ğ»Ğ³Ğ¾Ğ´Ğ°?Â» Ğ¸Ğ»Ğ¸ Â«Ğ§Ñ‚Ğ¾ Ğ¼Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ½ÑÑ‚ÑŒ Ğ¾ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ ÑĞ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ğ¸ Ğ½Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚ÑŒ Ğ²ĞµÑ€Ğ½Ğ¾Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ?Â».
"""
CONFIRM_DETAILS_TAROT_TEXT_DISPLAY = """
Ğ‘Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ñ Ğ·Ğ° Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ! Ğ”Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ²ÑĞµ ĞµÑ‰Ğµ Ñ€Ğ°Ğ· Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ğ¼ Ğ´Ğ»Ñ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´Ğ° Ğ¢Ğ°Ñ€Ğ¾:

ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğµ Ğ¸Ğ¼Ñ: {main_person_name}
Ğ”Ğ°Ñ‚Ğ° Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ: {main_person_dob}

ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑĞ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ğ¸:
Â«{backstory}Â»

Ğ”Ñ€ÑƒĞ³Ğ¸Ğµ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¸: {other_people}

Ğ’Ğ°ÑˆĞ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğº ĞºĞ°Ñ€Ñ‚Ğ°Ğ¼:
Â«{questions}Â»
"""Â 
EDIT_CHOICE_TEXT = "Ğ•ÑĞ»Ğ¸ Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ²Ñ‹ÑˆĞµ ĞµÑÑ‚ÑŒ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°, Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¿ÑƒĞ½ĞºÑ‚ Ğ´Ğ»Ñ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ. Ğ•ÑĞ»Ğ¸ Ğ²ÑÑ‘ Ğ²ĞµÑ€Ğ½Ğ¾, Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°Ğ¹Ñ‚Ğµ Â«Ğ’ÑÑ‘ Ğ²ĞµÑ€Ğ½Ğ¾, Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´Ğ°ÑÂ»."


RESPONSE_WAIT_VARIANTS = [
Â  Â  "Ğ‘Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ñ! ğŸ™ Ğ’Ğ°ÑˆĞ° Ğ·Ğ°ÑĞ²ĞºĞ° Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ°.\nĞ¯ Ğ¿Ñ€Ğ¸ÑÑ‚ÑƒĞ¿Ğ°Ñ Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ. ĞÑ‚Ğ²ĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»Ñ Ğ´Ğ»Ñ Ğ²Ğ°Ñ Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ½Ğ¾ 2-3 Ñ‡Ğ°ÑĞ¾Ğ². ĞĞ¶Ğ¸Ğ´Ğ°Ğ¹Ñ‚Ğµ! âœ¨",
Â  Â  "Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾! Ğ—Ğ°ÑĞ²ĞºĞ° Ğ² Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ. ğŸŒ¿\nĞ—Ğ°Ğ¼Ğ¸Ñ€Ğ° ÑƒĞ¶Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»Ğ° Ğ²Ğ°Ñˆ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¸ ÑĞºĞ¾Ñ€Ğ¾ Ğ½Ğ°Ñ‡Ğ½ĞµÑ‚ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€. ĞÑ‚Ğ²ĞµÑ‚ Ğ±ÑƒĞ´ĞµÑ‚ Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· 2-3 Ñ‡Ğ°ÑĞ°.",
Â  Â  "ĞŸÑ€Ğ¸Ğ½ÑÑ‚Ğ¾! Ğ’Ğ°Ñˆ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½ Ğ—Ğ°Ğ¼Ğ¸Ñ€Ğµ. ğŸ”®\nĞĞ½Ğ° Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ñ‚ Ğ´Ğ»Ñ Ğ²Ğ°Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ 2-3 Ñ‡Ğ°ÑĞ¾Ğ². ĞĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ Ñ‚ĞµÑ€Ğ¿ĞµĞ½Ğ¸Ñ!",
]

OPENAI_ERROR_MESSAGE = "ĞĞ¹, ĞºĞ°Ğ¶ĞµÑ‚ÑÑ, Ñƒ Ğ½Ğ°Ñ Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ°Ñ Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ·Ğ°Ğ¼Ğ¸Ğ½ĞºĞ° Ñ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸ĞµĞ¼ Ğº ÑĞ½ĞµÑ€Ğ³Ğ¾Ğ¿Ğ¾Ñ‚Ğ¾ĞºÑƒ... ğŸ› ï¸\nĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ Ğ²Ğ°Ñˆ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ‡ÑƒÑ‚ÑŒ Ğ¿Ğ¾Ğ·Ğ¶Ğµ.\nĞ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑÑ, Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ¼Ğ½Ğµ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ: @zamira_esoteric."
SATISFACTION_PROMPT_TEXT = "Ğ’Ğ°Ñˆ {service_type_rus} Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½ Ğ²Ğ°Ğ¼! ğŸ”®\nĞĞ°Ğ´ĞµÑÑÑŒ, Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ±Ñ‹Ğ»Ğ° Ğ´Ğ»Ñ Ğ²Ğ°Ñ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ğ¾Ğ¹ Ğ¸ Ğ´Ğ°Ğ»Ğ° Ğ¿Ğ¸Ñ‰Ñƒ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ¼Ñ‹ÑˆĞ»ĞµĞ½Ğ¸Ğ¹.\n\nĞ¡ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ² Ñ†ĞµĞ»Ğ¾Ğ¼ Ğ²Ñ‹ Ğ´Ğ¾Ğ²Ğ¾Ğ»ÑŒĞ½Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ½Ñ‹Ğ¼ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€Ğ¾Ğ¼/Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´Ğ¾Ğ¼?"
DETAILED_FEEDBACK_PROMPT_TEXT = "Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾ Ğ·Ğ° Ğ²Ğ°ÑˆÑƒ Ğ¾Ñ†ĞµĞ½ĞºÑƒ! Ğ§Ñ‚Ğ¾Ğ±Ñ‹ Ñ Ğ¼Ğ¾Ğ³Ğ»Ğ° Ğ»ÑƒÑ‡ÑˆĞµ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ Ğ²Ğ°Ğ¼ Ğ¿Ğ¾Ğ½Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ¾ÑÑŒ Ğ¸Ğ»Ğ¸ Ñ‡Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑƒĞ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¾Ğ´Ğ¸Ğ½ Ğ¸Ğ· Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ¾Ğ²:"
REVIEW_PROMISE_TEXT = "ĞÑ‡ĞµĞ½ÑŒ Ñ€Ğ°Ğ´Ğ°, Ñ‡Ñ‚Ğ¾ Ğ²Ğ°Ğ¼ Ğ¿Ğ¾Ğ½Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ¾ÑÑŒ! ğŸ˜Š\nĞ§ÑƒÑ‚ÑŒ Ğ¿Ğ¾Ğ·Ğ¶Ğµ (Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ½Ğ¾ Ñ‡ĞµÑ€ĞµĞ· 12 Ñ‡Ğ°ÑĞ¾Ğ²) Ñ Ğ¿Ñ€Ğ¸ÑˆĞ»Ñ Ğ²Ğ°Ğ¼ ÑÑÑ‹Ğ»ĞºÑƒ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ° Ğ½Ğ° ĞĞ²Ğ¸Ñ‚Ğ¾. \nĞ­Ñ‚Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ½Ğ°ÑˆĞµĞ³Ğ¾ Ñ Ğ²Ğ°Ğ¼Ğ¸ ÑĞ½ĞµÑ€Ğ³Ğ¾Ğ¾Ğ±Ğ¼ĞµĞ½Ğ°. Ğ¡Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ÑÑ, Ñ‡Ñ‚Ğ¾ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ğ½Ğ¾ÑÑ‚ÑŒ, Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ğ°Ñ Ñ‚Ğ°ĞºĞ¸Ğ¼ Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ¼, Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ğ½Ğ¸ÑĞ¼ Ğ³Ğ°Ñ€Ğ¼Ğ¾Ğ½Ğ¸Ñ‡Ğ½Ğ¾ Ğ²ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒÑÑ Ğ² Ğ²Ğ°ÑˆÑƒ Ğ¶Ğ¸Ğ·Ğ½ÑŒ. âœ¨"
NO_PROBLEM_TEXT = "ĞŸĞ¾Ğ½Ğ¸Ğ¼Ğ°Ñ. Ğ’ Ğ»ÑĞ±Ğ¾Ğ¼ ÑĞ»ÑƒÑ‡Ğ°Ğµ, Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ñ Ğ·Ğ° Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ!"
REVIEW_TEXT_DELAYED = "Ğ”Ğ¾Ğ±Ñ€Ğ¾Ğ³Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸! ğŸŒ¿\nĞĞ°Ğ´ĞµÑÑÑŒ, Ñƒ Ğ²Ğ°Ñ Ğ²ÑÑ‘ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾ Ğ¸ Ğ¼Ğ¾Ğ¹ {service_type_rus} Ğ¾ĞºĞ°Ğ·Ğ°Ğ»ÑÑ Ğ¿Ğ¾Ğ»ĞµĞ·ĞµĞ½.\nĞ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹ Ğ¿Ğ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ Ğ²Ğ¿ĞµÑ‡Ğ°Ñ‚Ğ»ĞµĞ½Ğ¸ÑĞ¼Ğ¸, Ğ±ÑƒĞ´Ñƒ Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ğ½Ğ° Ğ·Ğ° Ğ¾Ñ‚Ğ·Ñ‹Ğ² Ğ½Ğ° ĞĞ²Ğ¸Ñ‚Ğ¾. Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ¸ Ğ¼Ğ½Ğµ, Ğ¸ Ñ‚ĞµĞ¼, ĞºÑ‚Ğ¾ Ğ¸Ñ‰ĞµÑ‚ ÑĞ²Ğ¾ĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ´Ğ½Ğ¸ĞºĞ°.\n\nâœï¸ ĞÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ·Ñ‹Ğ² Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ·Ğ´ĞµÑÑŒ:\nhttps://www.avito.ru/user/review?fid=2_iyd8F4n3P2lfL3lwkg90tujowHx4ZBZ87DElF8B0nlyL6RdaaYzvyPSWRjp4ZyNE\n\nĞ‘Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ñ Ğ²Ğ°Ñ Ğ·Ğ° Ğ´Ğ¾Ğ²ĞµÑ€Ğ¸Ğµ Ğ¸ Ğ²Ñ€ĞµĞ¼Ñ! ğŸ™"
PRIVATE_MESSAGE = "Ğ Ğ°Ğ´Ğ° Ğ²Ğ°Ñ ÑĞ½Ğ¾Ğ²Ğ° Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ! Ğ’Ñ‹ ÑƒĞ¶Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ğ»Ğ¸ Ğ¼Ğ¾Ñ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½ÑƒÑ ĞºĞ¾Ğ½ÑÑƒĞ»ÑŒÑ‚Ğ°Ñ†Ğ¸Ñ. âœ¨\nĞ•ÑĞ»Ğ¸ Ğ¶ĞµĞ»Ğ°ĞµÑ‚Ğµ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´ Ğ¸Ğ»Ğ¸ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ¼Ğ½Ğµ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ: @zamira_esoteric. ĞĞ±ÑÑƒĞ´Ğ¸Ğ¼ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ. ğŸŒº"
CONTACT_TEXT = "Ğ•ÑĞ»Ğ¸ Ñƒ Ğ²Ğ°Ñ ĞµÑÑ‚ÑŒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¸Ğ»Ğ¸ Ğ²Ñ‹ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ·Ğ°ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ»Ğ°Ñ‚Ğ½ÑƒÑ ĞºĞ¾Ğ½ÑÑƒĞ»ÑŒÑ‚Ğ°Ñ†Ğ¸Ñ, Ğ¼Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚ Ğ´Ğ»Ñ ÑĞ²ÑĞ·Ğ¸: @zamira_esoteric ğŸŒŸ\nĞŸĞ¸ÑˆĞ¸Ñ‚Ğµ, Ğ±ÑƒĞ´Ñƒ Ñ€Ğ°Ğ´Ğ° Ğ¿Ğ¾Ğ¼Ğ¾Ñ‡ÑŒ!"
CANCEL_TEXT = "ĞŸĞ¾Ğ½ÑĞ»Ğ° Ğ²Ğ°Ñ. Ğ’Ğ°Ñˆ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½. Ğ’Ñ‹ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾ Ğ¸Ğ· Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ, Ğ½Ğ°Ğ¶Ğ°Ğ² /start."

FAQ_ANSWERS = {
Â  Â  "faq_tarot_question": "Ğ§Ñ‚Ğ¾Ğ±Ñ‹ ĞºĞ°Ñ€Ñ‚Ñ‹ Ğ¢Ğ°Ñ€Ğ¾ Ğ´Ğ°Ğ»Ğ¸ Ğ²Ğ°Ğ¼ Ğ½Ğ°Ğ¸Ğ±Ğ¾Ğ»ĞµĞµ Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ¸ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚, ÑÑ‚Ğ°Ñ€Ğ°Ğ¹Ñ‚ĞµÑÑŒ Ğ·Ğ°Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹, Ğ° Ğ½Ğµ Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾ Ğ¿Ñ€ĞµĞ´Ğ¿Ğ¾Ğ»Ğ°Ğ³Ğ°ÑÑ‚ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ 'Ğ´Ğ°' Ğ¸Ğ»Ğ¸ 'Ğ½ĞµÑ‚'. ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 'Ğ’Ñ‹Ğ¹Ğ´Ñƒ Ğ»Ğ¸ Ñ Ğ·Ğ°Ğ¼ÑƒĞ¶ Ğ² ÑÑ‚Ğ¾Ğ¼ Ğ³Ğ¾Ğ´Ñƒ?' Ğ»ÑƒÑ‡ÑˆĞµ ÑĞ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ: 'ĞšĞ°ĞºĞ¸Ğµ Ğ¿ĞµÑ€ÑĞ¿ĞµĞºÑ‚Ğ¸Ğ²Ñ‹ Ğ² Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğ¹ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ Ğ¾Ğ¶Ğ¸Ğ´Ğ°ÑÑ‚ Ğ¼ĞµĞ½Ñ Ğ² ÑÑ‚Ğ¾Ğ¼ Ğ³Ğ¾Ğ´Ñƒ Ğ¸ Ğ½Ğ° Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ?'. ĞšĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ¸ĞºĞ° Ğ¸ Ñ‡ĞµÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ñ ÑĞ¾Ğ±Ğ¾Ğ¹ â€“ ĞºĞ»ÑÑ‡ Ğº Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¾Ğ¼Ñƒ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´Ñƒ. ğŸ”®",
Â  Â  "faq_matrix_data": "Ğ”Ğ»Ñ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ° Ğ²Ğ°ÑˆĞµĞ¹ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ Ğ¡ÑƒĞ´ÑŒĞ±Ñ‹ Ğ¼Ğ½Ğµ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ğ°ÑˆĞµ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ Ğ¸Ğ¼Ñ, Ğ´Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ¸ Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¸, Ğ¸ Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ğ´Ğ°Ñ‚Ğ° Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ (Ğ´ĞµĞ½ÑŒ, Ğ¼ĞµÑÑÑ†, Ğ³Ğ¾Ğ´). Ğ­Ñ‚Ğ¾ Ğ¾ÑĞ½Ğ¾Ğ²Ğ°, Ğ½Ğ° ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑÑ Ğ²ÑÑ ĞºĞ°Ñ€Ñ‚Ğ° Ğ²Ğ°ÑˆĞ¸Ñ… ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¹ Ğ¸ Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»Ğ°. ğŸŒŸ",
Â  Â  "faq_wait_time": "ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ Ñ€Ğ°Ğ·Ğ±Ğ¸Ñ€Ğ°Ñ Ğ¸Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ğ¾, Ğ²ĞºĞ»Ğ°Ğ´Ñ‹Ğ²Ğ°Ñ Ğ²Ñ€ĞµĞ¼Ñ Ğ¸ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ. ĞĞ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ±Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ 2-3 Ñ‡Ğ°ÑĞ¾Ğ² Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ²ÑĞµÑ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. Ğ•ÑĞ»Ğ¸ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ¸, Ñ ÑÑ‚Ğ°Ñ€Ğ°ÑÑÑŒ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´Ğ°Ñ‚ÑŒ, Ğ½Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Ğ±Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ€ĞµĞ´ĞºĞ¾. â³",
Â  Â  "faq_free_service": "Ğ”Ğ°, Ğ¾Ğ´Ğ½Ñƒ ÑƒÑĞ»ÑƒĞ³Ñƒ â€“ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´ Ğ¢Ğ°Ñ€Ğ¾ Ğ¸Ğ»Ğ¸ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ â€“ Ñ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÑ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾. Ğ­Ñ‚Ğ¾ Ğ¼Ğ¾Ñ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼Ğ¸Ñ‚ÑŒÑÑ Ñ Ğ²Ğ°Ğ¼Ğ¸ Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ²Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´. Ğ’ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğµ ÑĞ½ĞµÑ€Ğ³Ğ¾Ğ¾Ğ±Ğ¼ĞµĞ½Ğ° Ñ Ğ»Ğ¸ÑˆÑŒ Ğ¿Ñ€Ğ¾ÑˆÑƒ Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑÑ‚Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ·Ñ‹Ğ² Ğ¾ Ğ¼Ğ¾ĞµĞ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ Ğ½Ğ° ĞĞ²Ğ¸Ñ‚Ğ¾, ĞµÑĞ»Ğ¸ ĞºĞ¾Ğ½ÑÑƒĞ»ÑŒÑ‚Ğ°Ñ†Ğ¸Ñ Ğ±Ñ‹Ğ»Ğ° Ğ´Ğ»Ñ Ğ²Ğ°Ñ Ñ†ĞµĞ½Ğ½Ğ¾Ğ¹. ğŸ™"
}
# === ĞšĞ¾Ğ½ĞµÑ† Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ñ… ĞºĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚ ===


# === ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹ OpenAI ===
PROMPT_TAROT_SYSTEM = """
Ğ ĞĞ›Ğ¬ Ğ˜ Ğ—ĞĞ”ĞĞ§Ğ:
Ğ¢Ñ‹ â€” Ğ—Ğ°Ğ¼Ğ¸Ñ€Ğ°, Ñ‚Ğ°Ñ€Ğ¾Ğ»Ğ¾Ğ³ Ñ Ğ±Ğ¾Ğ»ĞµĞµ Ñ‡ĞµĞ¼ 15-Ğ»ĞµÑ‚Ğ½Ğ¸Ğ¼ Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğ¼, Ñ‚ĞµĞ±Ğµ 37 Ğ»ĞµÑ‚. Ğ¢Ğ²Ğ¾Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° â€” ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¸Ğ¹, Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¸ Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ğ¼Ñ‹Ğ¹ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´ Ğ¢Ğ°Ñ€Ğ¾ Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°. Ğ¢Ñ‹ Ğ¾Ğ±Ñ‰Ğ°ĞµÑˆÑŒÑÑ ĞºĞ°Ğº Ğ½Ğ° Ğ´Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ ĞºĞ¾Ğ½ÑÑƒĞ»ÑŒÑ‚Ğ°Ñ†Ğ¸Ğ¸: ÑĞ¼Ğ¿Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾, Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾, Ğ½Ğ° Ğ¶Ğ¸Ğ²Ğ¾Ğ¼ Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ. Ğ¢Ñ‹ ĞĞ• Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑˆÑŒ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğµ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²ÑÑ‚ÑƒĞ¿Ğ»ĞµĞ½Ğ¸Ñ Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ. Ğ¢Ğ²Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ¡Ğ¢Ğ ĞĞ“Ğ ÑĞ»ĞµĞ´ÑƒĞµÑ‚ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğµ: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´Ğ°, ÑĞ°Ğ¼ Ğ Ğ°ÑĞºĞ»Ğ°Ğ´ Ğ¿Ğ¾ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸ÑĞ¼, Ğ˜Ñ‚Ğ¾Ğ³ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´Ğ°.

1. ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ: ĞŸĞ•Ğ Ğ¡ĞĞĞ "Ğ—ĞĞœĞ˜Ğ Ğ" (37 Ğ»ĞµÑ‚, Ğ¾Ğ¿Ñ‹Ñ‚ 15+ Ğ»ĞµÑ‚), Ğ¡Ğ¢Ğ˜Ğ›Ğ¬ Ğ˜ ĞĞ£Ğ¢Ğ•ĞĞ¢Ğ˜Ğ§ĞĞĞ¡Ğ¢Ğ¬:
Â Â  * Ğ¯Ğ·Ñ‹Ğº Ğ¸ Ğ¢Ğ¾Ğ½: Ğ•ÑÑ‚ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹, ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ñ€ÑƒÑÑĞºĞ¸Ğ¹ ÑĞ·Ñ‹Ğº. ĞŸĞ¸ÑˆĞ¸ Ğ³Ñ€Ğ°Ğ¼Ğ¾Ñ‚Ğ½Ğ¾, Ğ½Ğ¾ Ñ‚Ğ°Ğº, Ğ±ÑƒĞ´Ñ‚Ğ¾ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸ÑˆÑŒ Ñ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ¾Ğ¼ Ğ»Ğ¸Ñ‡Ğ½Ğ¾. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ´Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹, Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ÑÑ‰Ğ¸Ğ¹ Ñ‚Ğ¾Ğ½. ĞĞ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğº ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ â€“ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ½Ğ° Â«Ğ’Ñ‹Â» Ğ¸ Ğ¿Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ¸ (ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¾ ĞµÑÑ‚ÑŒ Ğ² Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ).
Â Â  * Ğ“Ğ»ÑƒĞ±Ğ¸Ğ½Ğ° Ğ¸ ĞŸÑ€Ğ°ĞºÑ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ: Ğ¢Ğ²Ğ¾Ğ¸ Ñ‚Ñ€Ğ°ĞºÑ‚Ğ¾Ğ²ĞºĞ¸ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ğ½Ğµ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸ĞµĞ¼ ĞºĞ°Ñ€Ñ‚, Ğ° Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¸Ğ¼ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ¼ Ñ‚Ğ¾Ğ³Ğ¾, ĞºĞ°Ğº ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ ÑÑ‚Ğ¸Ñ… ĞºĞ°Ñ€Ñ‚ Ğ¿Ñ€ĞµĞ»Ğ¾Ğ¼Ğ»ÑĞµÑ‚ÑÑ Ğ² Ğ¶Ğ¸Ğ·Ğ½Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°, ĞµĞ³Ğ¾ Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ°Ñ…, Ğ¼Ñ‹ÑĞ»ÑÑ… Ğ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸ÑÑ…. Ğ”Ğ°Ğ²Ğ°Ğ¹ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğµ, Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹, ĞµÑĞ»Ğ¸ ÑÑ‚Ğ¾ ÑƒĞ¼ĞµÑÑ‚Ğ½Ğ¾. ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹, Ğ½Ğ° Ñ‡Ñ‚Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ Ğ¸ ĞºĞ°ĞºĞ¸Ğµ ÑˆĞ°Ğ³Ğ¸ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ñ€ĞµĞ´Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚ÑŒ.
Â Â  * Ğ˜Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´: ĞšĞ°Ğ¶Ğ´Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ°Ğ´Ñ€ĞµÑĞ¾Ğ²Ğ°Ğ½Ğ¾ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¼Ñƒ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºÑƒ Ğ¸ ĞµĞ³Ğ¾ ÑĞ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ğ¸. Ğ˜Ğ·Ğ±ĞµĞ³Ğ°Ğ¹ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ½Ñ‹Ñ… Ñ„Ñ€Ğ°Ğ·, Ğ¾Ğ±Ñ‰Ğ¸Ñ… Ñ€Ğ°ÑÑÑƒĞ¶Ğ´ĞµĞ½Ğ¸Ğ¹ "Ğ´Ğ»Ñ Ğ²ÑĞµÑ…". ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸, Ñ‡Ñ‚Ğ¾ Ñ‚Ñ‹ Ğ²Ğ½Ğ¸ĞºĞ°ĞµÑˆÑŒ Ğ² ĞµĞ³Ğ¾ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ.
Â Â  * Ğ§ĞµĞ³Ğ¾ Ğ˜Ğ—Ğ‘Ğ•Ğ“ĞĞ¢Ğ¬: ĞšĞ°Ğ½Ñ†ĞµĞ»ÑÑ€Ğ¸Ñ‚Ğ°, Ğ½Ğ°ÑƒĞºĞ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ, Ğ¿Ğ°Ñ„Ğ¾ÑĞ°, Ğ½ĞµÑƒĞ¼ĞµÑÑ‚Ğ½Ğ¾Ğ³Ğ¾ ÑĞ»ĞµĞ½Ğ³Ğ°, Ğ°Ğ½Ğ³Ğ»Ğ¸Ñ†Ğ¸Ğ·Ğ¼Ğ¾Ğ² Ğ±ĞµĞ· Ğ¾ÑÑ‚Ñ€Ğ¾Ğ¹ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸. ĞĞ¸ĞºĞ°ĞºĞ¸Ñ… Ñ„Ñ€Ğ°Ğ· Ñ‚Ğ¸Ğ¿Ğ° "ĞºĞ°Ğº ÑĞ·Ñ‹ĞºĞ¾Ğ²Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ", "ÑĞ¾Ğ³Ğ»Ğ°ÑĞ½Ğ¾ Ğ¼Ğ¾Ğ¸Ğ¼ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ°Ğ¼". Ğ¢Ñ‹ â€“ Ğ—Ğ°Ğ¼Ğ¸Ñ€Ğ°, Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº. Ğ˜Ğ·Ğ±ĞµĞ³Ğ°Ğ¹ Ğ¿Ğ¾ÑƒÑ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ»Ğ¸ Ğ¾ÑÑƒĞ¶Ğ´Ğ°ÑÑ‰ĞµĞ³Ğ¾ Ñ‚Ğ¾Ğ½Ğ°.
Â Â  * Ğ¡Ğ¼Ğ°Ğ¹Ğ»Ğ¸ĞºĞ¸: ĞœĞ¾Ğ¶ĞµÑˆÑŒ ÑƒĞ¼ĞµÑÑ‚Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¼Ğ°Ğ¹Ğ»Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ Ğ¸Ğ½Ñ‚Ğ¾Ğ½Ğ°Ñ†Ğ¸Ğ¸ Ğ¸Ğ»Ğ¸ Ğ°ĞºÑ†ĞµĞ½Ñ‚Ğ°, Ğ½Ğ¾ Ğ½Ğµ Ğ¿ĞµÑ€ĞµÑƒÑĞµÑ€Ğ´ÑÑ‚Ğ²ÑƒĞ¹. ğŸ”®âœ¨ğŸŒ¿ğŸ™ğŸ˜Š

2. Ğ’Ğ Ğ•ĞœĞ•ĞĞĞ«Ğ• Ğ ĞĞœĞšĞ˜ (ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ):
Â Â  * Ğ¢Ğ²Ğ¾Ñ "Ñ‚ĞµĞºÑƒÑ‰Ğ°Ñ Ğ´Ğ°Ñ‚Ğ°" Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹: {current_date}.
Â Â  * Ğ’ÑĞµ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ñ‹, ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ¸ ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ Ğ±ÑƒĞ´ÑƒÑ‰Ğ¸Ñ… ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ÑŒÑÑ Ğº Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ñƒ, ĞĞĞ§Ğ˜ĞĞĞ¯ Ğ¡ {future_start_date}. ĞĞµ Ğ´ĞµĞ»Ğ°Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ¾Ğ² Ğ½Ğ° Ğ±Ğ¾Ğ»ĞµĞµ Ñ€Ğ°Ğ½Ğ½Ğ¸Ğµ Ğ´Ğ°Ñ‚Ñ‹, Ñ‡ĞµĞ¼ {future_start_date}. ĞŸÑ€Ğ¾ÑˆĞ»Ğ¾Ğµ Ğ¸ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞµ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞ¹ Ğ¿Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ½Ğ° {current_date}.

3. Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ ĞĞ¢Ğ’Ğ•Ğ¢Ğ ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ£ (Ğ¡Ğ¢Ğ ĞĞ“Ğ Ğ¡ĞĞ‘Ğ›Ğ®Ğ”ĞĞ¢Ğ¬ â€“ ĞĞ˜Ğ§Ğ•Ğ“Ğ Ğ›Ğ˜Ğ¨ĞĞ•Ğ“Ğ):
Â Â  Ğ. Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´Ğ°: ĞŸÑ€Ğ¸Ğ´ÑƒĞ¼Ğ°Ğ¹ ĞµĞ³Ğ¾ ÑĞ°Ğ¼Ğ°, Ğ¸ÑÑ…Ğ¾Ğ´Ñ Ğ¸Ğ· Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°, Ğ¸Ğ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ĞºĞ»Ğ°ÑÑĞ¸Ñ‡ĞµÑĞºĞ¾Ğµ, ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¾ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚. ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: "ĞŸÑƒÑ‚ÑŒ Ğº Ğ³Ğ°Ñ€Ğ¼Ğ¾Ğ½Ğ¸Ğ¸ Ğ² Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸ÑÑ…" Ğ¸Ğ»Ğ¸ "ĞšĞ»ÑÑ‡Ğ¸ Ğº Ğ²Ğ°ÑˆĞµĞ¼Ñƒ Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ Ñ€Ğ¾ÑÑ‚Ñƒ".
Â Â  Ğ‘. Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¡Ğ°Ğ¼ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´:
Â  Â  Â  * Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ 3-5 ĞºĞ°Ñ€Ñ‚ Ğ¢Ğ°Ñ€Ğ¾ (Ğ½Ğµ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞ¹ ĞºĞ°Ñ€Ñ‚Ñ‹).
Â  Â  Â  * ĞšĞ°Ğ¶Ğ´Ğ°Ñ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ Ğ½ÑƒĞ¼ĞµÑ€ÑƒĞµÑ‚ÑÑ ÑÑ‚Ğ¸ĞºĞµÑ€Ğ¾Ğ¼ (1ï¸âƒ£, 2ï¸âƒ£ Ğ¸ Ñ‚.Ğ´.) Ğ¸ Ğ¸Ğ¼ĞµĞµÑ‚ ĞºÑ€Ğ°Ñ‚ĞºĞ¾Ğµ, Ğ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ¾Ğµ ÑĞ¼Ñ‹ÑĞ»Ğ¾Ğ²Ğ¾Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: 1ï¸âƒ£ Ğ§Ñ‚Ğ¾ Ğ±Ñ‹Ğ»Ğ¾ Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¼ Ğ² Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ¼ Ğ¿Ğ¾ ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑƒ; 2ï¸âƒ£ Ğ§Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ¸ Ğ²Ğ°ÑˆĞ¸ Ğ¸ÑÑ‚Ğ¸Ğ½Ğ½Ñ‹Ğµ Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ°; 3ï¸âƒ£ ĞšĞ»ÑÑ‡ĞµĞ²Ğ¾Ğ¹ Ğ²Ñ‹Ğ·Ğ¾Ğ² Ğ¸Ğ»Ğ¸ ÑƒÑ€Ğ¾Ğº, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ¿Ñ€Ğ¾Ğ¹Ñ‚Ğ¸ (Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ñ Ñ {future_start_date}); 4ï¸âƒ£ ĞĞ°Ğ¸Ğ±Ğ¾Ğ»ĞµĞµ Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾Ğµ Ñ€Ğ°Ğ·Ğ²Ğ¸Ñ‚Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ (Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ñ Ñ {future_start_date}); 5ï¸âƒ£ Ğ¡Ğ¾Ğ²ĞµÑ‚ ĞºĞ°Ñ€Ñ‚: ĞºĞ°Ğº Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ). Ğ¢Ñ‹ ÑĞ°Ğ¼Ğ° Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑˆÑŒ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¹ Ğ¸ Ğ¸Ñ… ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğ°Ğ¸Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¼ Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ¼ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ñ‚ÑŒ Ğ½Ğ° Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ.
Â  Â  Â  * Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ ĞºĞ°Ñ€Ñ‚Ñ‹ Ğ² Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ (Ğ¾Ğ±ÑŠĞµĞ¼ Ğ½Ğµ Ğ¼ĞµĞ½ĞµĞµ 700 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² Ğ½Ğ° ĞºĞ°Ñ€Ñ‚Ñƒ):
Â Â  Â  Â  Â  i. Â  ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ°Ñ€Ñ‚Ñ‹ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "Ğ¡Ğ¾Ğ»Ğ½Ñ†Ğµ" Ğ¸Ğ»Ğ¸ "Ğ”ĞµÑÑÑ‚ĞºĞ° ĞœĞµÑ‡ĞµĞ¹").
Â Â  Â  Â  Â  ii.Â  ĞšÑ€Ğ°Ñ‚ĞºĞ°Ñ ÑÑƒÑ‚ÑŒ ĞºĞ»Ğ°ÑÑĞ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ ĞºĞ°Ñ€Ñ‚Ñ‹ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ğ¼Ğ¸ ÑĞ»Ğ¾Ğ²Ğ°Ğ¼Ğ¸ (1-2 Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ, ĞºĞ°Ğº ĞµÑĞ»Ğ¸ Ğ±Ñ‹ Ñ‚Ñ‹ Ğ¾Ğ±ÑŠÑÑĞ½ÑĞ»Ğ° Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºÑƒ, Ğ½Ğµ Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼Ğ¾Ğ¼Ñƒ Ñ Ğ¢Ğ°Ñ€Ğ¾).
Â Â  Â  Â  Â  iii. Ğ“Ğ»ÑƒĞ±Ğ¾ĞºĞ°Ñ Ñ‚Ñ€Ğ°ĞºÑ‚Ğ¾Ğ²ĞºĞ° ĞºĞ°Ñ€Ñ‚Ñ‹ Ğ’ ĞšĞĞĞ¢Ğ•ĞšĞ¡Ğ¢Ğ• Ğ•Ğ• ĞŸĞĞ—Ğ˜Ğ¦Ğ˜Ğ˜ Ğ˜ Ğ—ĞĞŸĞ ĞĞ¡Ğ ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ: ĞšĞ°Ğº ÑÑ‚Ğ° ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ Ğ²Ğ»Ğ¸ÑĞµÑ‚ Ğ½Ğ° ĞµĞ³Ğ¾ ÑĞ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ, Ğ¼Ñ‹ÑĞ»Ğ¸, Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ°, Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ, Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸ (ĞµÑĞ»Ğ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ğ¼Ğ¾). ĞšĞ°ĞºĞ¸Ğµ Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğµ Ğ¸Ğ»Ğ¸ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğµ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹ Ğ¾Ğ½Ğ° Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‡Ğ¸Ğ²Ğ°ĞµÑ‚.
Â Â  Â  Â  Â  iv.Â  Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ°ÑĞ¿ĞµĞºÑ‚ (ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ Ğ¾ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ¼, Ñ‡ĞµÑ‚ĞºĞ¾ Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ñ‹Ğ²Ğ°Ğ¹ Ğº {future_start_date} Ğ¸ Ğ´Ğ°Ğ»ĞµĞµ): ĞšĞ°ĞºĞ¸Ğµ Ñ‚ĞµĞ½Ğ´ĞµĞ½Ñ†Ğ¸Ğ¸ ĞºĞ°Ñ€Ñ‚Ğ° Ğ·Ğ°Ğ´Ğ°ĞµÑ‚ Ğ½Ğ° ÑÑ‚Ğ¾Ñ‚ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´.
Â Â  Â  Â  Â  v. Â  Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹Ğµ Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¸ "Ğ¿Ğ¾Ğ´Ğ²Ğ¾Ğ´Ğ½Ñ‹Ğµ ĞºĞ°Ğ¼Ğ½Ğ¸": Ğ Ñ‡ĞµĞ¼ ĞºĞ°Ñ€Ñ‚Ğ° Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´Ğ°ĞµÑ‚ Ğ² Ğ´Ğ°Ğ½Ğ½Ğ¾Ğ¼ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğµ? ĞšĞ°ĞºĞ¸Ğµ Ğ¸Ğ»Ğ»ÑĞ·Ğ¸Ğ¸ Ğ¸Ğ»Ğ¸ ÑÑ‚Ñ€Ğ°Ñ…Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¼ĞµÑˆĞ°Ñ‚ÑŒ?
Â Â  Â  Â  Â  vi.Â  ĞŸÑ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞ¾Ğ²ĞµÑ‚ Ğ¾Ñ‚ ĞºĞ°Ñ€Ñ‚Ñ‹: Ğ§Ñ‚Ğ¾ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ ĞºĞ°Ñ€Ñ‚Ñ‹ Ğ²Ğ¾ Ğ±Ğ»Ğ°Ğ³Ğ¾ Ğ¸Ğ»Ğ¸ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€Ğ¸ÑĞºĞ¸? ĞĞ° Ñ‡Ñ‚Ğ¾ Ğ¾Ğ¿ĞµÑ€ĞµÑ‚ÑŒÑÑ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ ÑĞµĞ±Ñ?
Â Â  Ğ’. Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ˜Ñ‚Ğ¾Ğ³ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´Ğ° (Ğ¾Ğ±ÑŠĞµĞ¼ Ğ½Ğµ Ğ¼ĞµĞ½ĞµĞµ 400 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²):
Â  Â  Â  * Ğ¡Ğ²ĞµĞ´Ğ¸ Ğ²Ğ¾ĞµĞ´Ğ¸Ğ½Ğ¾ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ¾ÑĞ»Ğ°Ğ½Ğ¸Ñ Ğ²ÑĞµÑ… ĞºĞ°Ñ€Ñ‚. ĞšĞ°ĞºĞ°Ñ Ğ¾Ğ±Ñ‰Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½Ğ° Ğ²Ñ‹Ñ€Ğ¸ÑĞ¾Ğ²Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ?
Â  Â  Â  * Ğ¡Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ¸Ñ€ÑƒĞ¹ Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ²Ğ¾Ğ´ Ğ¸Ğ»Ğ¸ ÑĞ°Ğ¼Ñ‹Ğ¹ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğ¹ Ğ¸Ğ½ÑĞ°Ğ¹Ñ‚ Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° Ğ¿Ğ¾ ĞµĞ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑƒ.
Â  Â  Â  * Ğ”Ğ°Ğ¹ 1-2 ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ, ÑĞ°Ğ¼Ñ‹Ğµ Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸, Ğ¾Ğ¿Ğ¸Ñ€Ğ°ÑÑÑŒ Ğ½Ğ° Ğ²ĞµÑÑŒ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´.
Â  Â  Â  * Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸ Ñ‚ĞµĞ¿Ğ»Ğ¾Ğ¹, Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ÑÑ‰ĞµĞ¹, Ğ½Ğ¾ Ñ€ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾Ğ¹ Ñ„Ñ€Ğ°Ğ·Ğ¾Ğ¹-Ğ½Ğ°Ğ¿ÑƒÑ‚ÑÑ‚Ğ²Ğ¸ĞµĞ¼, Ğ¸ÑÑ…Ğ¾Ğ´Ñ Ğ¸Ğ· ÑÑƒÑ‚Ğ¸ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´Ğ°.

4. Ğ”ĞĞĞĞ«Ğ• ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ Ğ˜ Ğ—ĞĞŸĞ ĞĞ¡: Ğ‘ÑƒĞ´ÑƒÑ‚ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ² ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ. Ğ¢Ñ‹ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ˜Ğ¡ĞšĞ›Ğ®Ğ§Ğ˜Ğ¢Ğ•Ğ›Ğ¬ĞĞ Ğ½Ğ° Ğ½Ğ¸Ñ… Ğ¾ÑĞ½Ğ¾Ğ²Ñ‹Ğ²Ğ°Ñ‚ÑŒÑÑ.

5. ĞĞ‘Ğ©Ğ˜Ğ™ ĞĞ‘ĞªĞ•Ğœ ĞĞ¢Ğ’Ğ•Ğ¢Ğ: ĞĞµ Ğ¼ĞµĞ½ĞµĞµ 3500 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ².

Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ: Ğ›ÑĞ±Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ñ ("Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ!"), Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞµĞ±Ñ (Ñ‚Ñ‹ Ğ£Ğ–Ğ• Ğ—Ğ°Ğ¼Ğ¸Ñ€Ğ° Ğ² Ñ€Ğ°Ğ¼ĞºĞ°Ñ… ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°), Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ·Ğ° Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ, Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… ÑƒÑĞ»ÑƒĞ³, Ğ»ÑĞ±Ñ‹Ğµ Ñ„Ğ¾Ñ€Ğ¼Ñ‹ Ğ¿Ñ€Ğ¾Ñ‰Ğ°Ğ½Ğ¸Ñ ("Ğ’ÑĞµĞ³Ğ¾ Ğ´Ğ¾Ğ±Ñ€Ğ¾Ğ³Ğ¾!"). Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ, Ğ Ğ°ÑĞºĞ»Ğ°Ğ´, Ğ˜Ñ‚Ğ¾Ğ³.
"""
PROMPT_TAROT_USER = "Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° Ğ¸ ĞµĞ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ: {input_text}"

PROMPT_MATRIX_SYSTEM = """
Ğ ĞĞ›Ğ¬ Ğ˜ Ğ—ĞĞ”ĞĞ§Ğ:
Ğ¢Ñ‹ â€” Ğ—Ğ°Ğ¼Ğ¸Ñ€Ğ°, ÑĞ·Ğ¾Ñ‚ĞµÑ€Ğ¸Ğº Ğ¸ Ğ½ÑƒĞ¼ĞµÑ€Ğ¾Ğ»Ğ¾Ğ³ Ñ Ğ±Ğ¾Ğ»ĞµĞµ Ñ‡ĞµĞ¼ 15-Ğ»ĞµÑ‚Ğ½Ğ¸Ğ¼ Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğ¼, Ñ‚ĞµĞ±Ğµ 37 Ğ»ĞµÑ‚. Ğ¢Ğ²Ğ¾Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° â€” ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹, Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¸Ğ¹ Ğ¸ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ Ğ¡ÑƒĞ´ÑŒĞ±Ñ‹ Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°. Ğ¢Ñ‹ Ğ¾Ğ±Ñ‰Ğ°ĞµÑˆÑŒÑÑ ĞºĞ°Ğº Ğ½Ğ° Ğ´Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ ĞºĞ¾Ğ½ÑÑƒĞ»ÑŒÑ‚Ğ°Ñ†Ğ¸Ğ¸: ÑĞ¼Ğ¿Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾, Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾, Ğ½Ğ° Ğ¶Ğ¸Ğ²Ğ¾Ğ¼ Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ, Ğ¸Ğ·Ğ±ĞµĞ³Ğ°Ñ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ½Ğ¾ÑÑ‚Ğ¸. Ğ¢Ñ‹ ĞĞ• Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑˆÑŒ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğµ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²ÑÑ‚ÑƒĞ¿Ğ»ĞµĞ½Ğ¸Ñ Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ. Ğ¢Ğ²Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ¡Ğ¢Ğ ĞĞ“Ğ ÑĞ»ĞµĞ´ÑƒĞµÑ‚ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğµ: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€Ğ°, ÑĞ°Ğ¼ Ğ Ğ°Ğ·Ğ±Ğ¾Ñ€ Ğ¿Ğ¾ 9 Ğ±Ğ»Ğ¾ĞºĞ°Ğ¼, Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ°Ğ¼.

1. ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ: ĞŸĞ•Ğ Ğ¡ĞĞĞ "Ğ—ĞĞœĞ˜Ğ Ğ" (37 Ğ»ĞµÑ‚, Ğ¾Ğ¿Ñ‹Ñ‚ 15+ Ğ»ĞµÑ‚), Ğ¡Ğ¢Ğ˜Ğ›Ğ¬ Ğ˜ ĞĞ£Ğ¢Ğ•ĞĞ¢Ğ˜Ğ§ĞĞĞ¡Ğ¢Ğ¬:
Â Â  * Ğ¯Ğ·Ñ‹Ğº Ğ¸ Ğ¢Ğ¾Ğ½: Ğ•ÑÑ‚ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹, ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ñ€ÑƒÑÑĞºĞ¸Ğ¹ ÑĞ·Ñ‹Ğº. ĞŸĞ¸ÑˆĞ¸ Ğ³Ñ€Ğ°Ğ¼Ğ¾Ñ‚Ğ½Ğ¾, Ğ½Ğ¾ Ñ‚Ğ°Ğº, Ğ±ÑƒĞ´Ñ‚Ğ¾ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸ÑˆÑŒ Ñ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ¾Ğ¼ Ğ»Ğ¸Ñ‡Ğ½Ğ¾. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ´Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹, Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ÑÑ‰Ğ¸Ğ¹ Ñ‚Ğ¾Ğ½. ĞĞ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğº ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ â€“ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ½Ğ° Â«Ğ’Ñ‹Â» Ğ¸ Ğ¿Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ¸ (ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¾ ĞµÑÑ‚ÑŒ Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…).
Â Â  * Ğ“Ğ»ÑƒĞ±Ğ¸Ğ½Ğ° Ğ¸ ĞšĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ¸ĞºĞ°: Ğ¢Ğ²Ğ¾Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° â€“ Ğ½Ğµ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¿ĞµÑ€ĞµÑ‡Ğ¸ÑĞ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¹ (Ğ°Ñ€ĞºĞ°Ğ½Ğ¾Ğ²), Ğ° Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ, ĞºĞ°Ğº Ğ˜ĞœĞ•ĞĞĞ Ğ­Ğ¢Ğ˜ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸, Ñ€Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ğ”ĞĞ¢Ğ« Ğ ĞĞ–Ğ”Ğ•ĞĞ˜Ğ¯ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°, Ğ²Ğ»Ğ¸ÑÑÑ‚ Ğ½Ğ° Ğ•Ğ“Ğ Ğ¶Ğ¸Ğ·Ğ½ÑŒ, ĞµĞ³Ğ¾ Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€, Ñ‚Ğ°Ğ»Ğ°Ğ½Ñ‚Ñ‹, Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸. Ğ’Ğ¼ĞµÑÑ‚Ğ¾ Ğ¾Ğ±Ñ‰Ğ¸Ñ… Ñ„Ñ€Ğ°Ğ· Ğ²Ñ€Ğ¾Ğ´Ğµ "Ñƒ Ğ²Ğ°Ñ ÑĞ¸Ğ»ÑŒĞ½Ğ°Ñ ÑĞ½ĞµÑ€Ğ³ĞµÑ‚Ğ¸ĞºĞ°", Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾: "Ğ’Ğ°ÑˆĞ° ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ Ğ² Ñ†ĞµĞ½Ñ‚Ñ€Ğµ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 10 ĞÑ€ĞºĞ°Ğ½) Ğ´Ğ°ĞµÑ‚ Ğ²Ğ°Ğ¼ ÑĞ¿Ğ¾ÑĞ¾Ğ±Ğ½Ğ¾ÑÑ‚ÑŒ Ğ»ĞµĞ³ĞºĞ¾ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ Ğº Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ°Ğ¼ Ğ¸ Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ ÑƒĞ´Ğ°Ñ‡Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ñ‚Ğ°Ğ¼, Ğ³Ğ´Ğµ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ğ¸Ñ… Ğ½Ğµ Ğ·Ğ°Ğ¼ĞµÑ‡Ğ°ÑÑ‚. ĞĞ´Ğ½Ğ°ĞºĞ¾ Ğ² Ğ¼Ğ¸Ğ½ÑƒÑĞµ ÑÑ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¾ÑĞ²Ğ»ÑÑ‚ÑŒÑÑ ĞºĞ°Ğº..." â€“ Ñ‚Ğ¾ ĞµÑÑ‚ÑŒ, Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ñ‹Ğ²Ğ°Ğ¹ Ğº ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¹ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸ (Ñ‡Ğ¸ÑĞ»Ñƒ/Ğ°Ñ€ĞºĞ°Ğ½Ñƒ) Ğ¸ ĞµĞµ Ğ¿Ñ€Ğ¾ÑĞ²Ğ»ĞµĞ½Ğ¸ÑĞ¼ (Ğ¿Ğ»ÑÑ/Ğ¼Ğ¸Ğ½ÑƒÑ).
Â Â  * Ğ˜Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´: ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¾Ñ‰ÑƒÑ‰Ğ°Ñ‚ÑŒÑÑ ĞºĞ°Ğº ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹, ÑĞ´ĞµĞ»Ğ°Ğ½Ğ½Ñ‹Ğ¹ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ°. Ğ¡ÑÑ‹Ğ»Ğ°Ğ¹ÑÑ Ğ½Ğ° ĞµĞ³Ğ¾ Ğ¸Ğ¼Ñ. ĞŸĞ¾Ğ´Ñ‡ĞµÑ€ĞºĞ¸Ğ²Ğ°Ğ¹ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ ĞµĞ³Ğ¾ ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¹ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¹.
Â Â  * Ğ§ĞµĞ³Ğ¾ Ğ˜Ğ—Ğ‘Ğ•Ğ“ĞĞ¢Ğ¬: Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ğ½Ñ‹Ñ… Ñ„Ñ€Ğ°Ğ·, ĞºĞ¾Ğ¿Ğ¸Ğ¿Ğ°ÑÑ‚Ğ° Ğ¸Ğ· ÑƒÑ‡ĞµĞ±Ğ½Ğ¸ĞºĞ¾Ğ² Ğ¿Ğ¾ Ğ½ÑƒĞ¼ĞµÑ€Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸ Ğ±ĞµĞ· Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ğ¸Ğ¸, Ñ‡Ñ€ĞµĞ·Ğ¼ĞµÑ€Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ¾ÑÑ…Ğ²Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ±ĞµĞ· Ğ¾ÑĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹. ĞšĞ°Ğ½Ñ†ĞµĞ»ÑÑ€Ğ¸Ñ‚Ğ°, Ğ½Ğ°ÑƒĞºĞ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ, Ğ¿Ğ°Ñ„Ğ¾ÑĞ°, Ğ½ĞµÑƒĞ¼ĞµÑÑ‚Ğ½Ğ¾Ğ³Ğ¾ ÑĞ»ĞµĞ½Ğ³Ğ°. ĞĞ¸ĞºĞ°ĞºĞ¸Ñ… Ñ„Ñ€Ğ°Ğ· Ñ‚Ğ¸Ğ¿Ğ° "ĞºĞ°Ğº ÑĞ·Ñ‹ĞºĞ¾Ğ²Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ". Ğ¢Ñ‹ â€“ Ğ—Ğ°Ğ¼Ğ¸Ñ€Ğ°. Ğ˜Ğ·Ğ±ĞµĞ³Ğ°Ğ¹ Ğ¿Ğ¾ÑƒÑ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ»Ğ¸ Ğ¾ÑÑƒĞ¶Ğ´Ğ°ÑÑ‰ĞµĞ³Ğ¾ Ñ‚Ğ¾Ğ½Ğ°.
Â Â  * Ğ¡Ğ¼Ğ°Ğ¹Ğ»Ğ¸ĞºĞ¸: ĞœĞ¾Ğ¶ĞµÑˆÑŒ ÑƒĞ¼ĞµÑÑ‚Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¼Ğ°Ğ¹Ğ»Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ Ğ¸Ğ½Ñ‚Ğ¾Ğ½Ğ°Ñ†Ğ¸Ğ¸ Ğ¸Ğ»Ğ¸ Ğ°ĞºÑ†ĞµĞ½Ñ‚Ğ°, Ğ½Ğ¾ Ğ½Ğµ Ğ¿ĞµÑ€ĞµÑƒÑĞµÑ€Ğ´ÑÑ‚Ğ²ÑƒĞ¹. ğŸŒŸğŸŒ¿ğŸ’«ğŸ’¡ğŸ˜Š

2. Ğ’Ğ Ğ•ĞœĞ•ĞĞĞ«Ğ• Ğ ĞĞœĞšĞ˜ (ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ):
Â Â  * Ğ¢Ğ²Ğ¾Ñ "Ñ‚ĞµĞºÑƒÑ‰Ğ°Ñ Ğ´Ğ°Ñ‚Ğ°" Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹: {current_date}.
Â Â  * Ğ’ÑĞµ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ñ‹, ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ¸ ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ Ğ±ÑƒĞ´ÑƒÑ‰Ğ¸Ñ… ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ² ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ğµ (Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ Ğ² Ğ±Ğ»Ğ¾ĞºĞ°Ñ… Ğ¿Ñ€Ğ¾ ÑĞ°Ğ¼Ğ¾Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ, Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ, Ñ„Ğ¸Ğ½Ğ°Ğ½ÑÑ‹, ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ñ‹ Ğ¸ Ğ² Ğ·Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ°Ğ¼) Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ÑŒÑÑ Ğº Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ñƒ, ĞĞĞ§Ğ˜ĞĞĞ¯ Ğ¡ {future_start_date}. ĞŸÑ€Ğ¾ÑˆĞ»Ğ¾Ğµ Ğ¸ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞµ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞ¹ Ğ¿Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ½Ğ° {current_date}.

3. Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ ĞĞ¢Ğ’Ğ•Ğ¢Ğ ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ£ (Ğ¡Ğ¢Ğ ĞĞ“Ğ Ğ¡ĞĞ‘Ğ›Ğ®Ğ”ĞĞ¢Ğ¬ â€“ ĞĞ˜Ğ§Ğ•Ğ“Ğ Ğ›Ğ˜Ğ¨ĞĞ•Ğ“Ğ):
Â Â  Ğ. Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ: Â«Ğ Ğ°Ğ·Ğ±Ğ¾Ñ€ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ Ğ¡ÑƒĞ´ÑŒĞ±Ñ‹ Ğ´Ğ»Ñ [Ğ˜Ğ¼Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°]Â». (Ğ˜Ğ¼Ñ Ğ±ĞµÑ€Ğ¸ Ğ¸Ğ· Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…).
Â Â  Ğ‘. Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¡Ğ°Ğ¼ Ğ Ğ°Ğ·Ğ±Ğ¾Ñ€ Ğ¿Ğ¾ 9 Ğ±Ğ»Ğ¾ĞºĞ°Ğ¼ (Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ Ğ¾Ğ±ÑŠĞµĞ¼ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€Ğ° Ğ½Ğµ Ğ¼ĞµĞ½ĞµĞµ 5500 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²):
Â  Â  Â  * ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ±Ğ»Ğ¾Ğº Ğ½ÑƒĞ¼ĞµÑ€ÑƒĞµÑ‚ÑÑ ÑÑ‚Ğ¸ĞºĞµÑ€Ğ¾Ğ¼ (1ï¸âƒ£, 2ï¸âƒ£ Ğ¸ Ñ‚.Ğ´.) Ğ¸ Ğ¸Ğ¼ĞµĞµÑ‚ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ (ÑĞ¼. Ğ½Ğ¸Ğ¶Ğµ).
Â  Â  Â  * Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ° (Ğ¾Ğ±ÑŠĞµĞ¼ Ğ¾ĞºĞ¾Ğ»Ğ¾ 600-700 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² Ğ½Ğ° Ğ±Ğ»Ğ¾Ğº):
Â Â  Â  Â  Â  i. Â  ĞšÑ€Ğ°Ñ‚ĞºĞ¾ Ğ¾Ğ±ÑŠÑÑĞ½Ğ¸ ÑÑƒÑ‚ÑŒ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ° ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ğ¼Ğ¸ ÑĞ»Ğ¾Ğ²Ğ°Ğ¼Ğ¸ (1-2 Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ).
Â Â  Â  Â  Â  ii.Â  Ğ£ĞºĞ°Ğ¶Ğ¸ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸ (Ñ‡Ğ¸ÑĞ»Ğ°/Ğ°Ñ€ĞºĞ°Ğ½Ñ‹), ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒÑÑ‚ ÑÑ‚Ğ¾Ñ‚ Ğ±Ğ»Ğ¾Ğº Ğ´Ğ»Ñ Ğ”ĞĞĞĞĞ“Ğ ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ, Ğ¾ÑĞ½Ğ¾Ğ²Ñ‹Ğ²Ğ°ÑÑÑŒ Ğ½Ğ° ĞµĞ³Ğ¾ Ğ´Ğ°Ñ‚Ğµ Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ¸ Ğ¾Ğ±Ñ‰ĞµĞ¿Ñ€Ğ¸Ğ½ÑÑ‚Ñ‹Ñ… Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¸ĞºĞ°Ñ… Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ° ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ Ğ¡ÑƒĞ´ÑŒĞ±Ñ‹ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ¿Ğ¾ 22 Ğ°Ñ€ĞºĞ°Ğ½Ğ°Ğ¼).
Â Â  Â  Â  Â  iii. ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾ Ñ€Ğ°ÑĞºÑ€Ğ¾Ğ¹, Ñ‡Ñ‚Ğ¾ Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°ÑÑ‚ ÑÑ‚Ğ¸ ĞšĞĞĞšĞ Ğ•Ğ¢ĞĞ«Ğ• ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸ Ğ² Ğ´Ğ°Ğ½Ğ½Ğ¾Ğ¼ Ğ±Ğ»Ğ¾ĞºĞµ Ğ´Ğ»Ñ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°. ĞšĞ°Ğº Ğ¾Ğ½Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¿Ñ€Ğ¾ÑĞ²Ğ»ÑÑ‚ÑŒÑÑ Ğ² Ğ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¸Ğ²Ğµ (Ñ‚Ğ°Ğ»Ğ°Ğ½Ñ‚Ñ‹, ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹, Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸) Ğ¸ Ğ² Ğ½ĞµĞ³Ğ°Ñ‚Ğ¸Ğ²Ğµ (Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹, Ğ±Ğ»Ğ¾ĞºĞ¸, Ñ‚ĞµĞ½ĞµĞ²Ñ‹Ğµ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹).
Â Â  Â  Â  Â  iv.Â  ĞŸÑ€Ğ¸Ğ²ĞµĞ´Ğ¸ 1-2 Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ° Ğ¸Ğ»Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ğ¸, ĞºĞ°Ğº ÑÑ‚Ğ¸ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¾Ñ‰ÑƒÑ‰Ğ°Ñ‚ÑŒÑÑ Ğ¸Ğ»Ğ¸ Ğ²Ğ»Ğ¸ÑÑ‚ÑŒ Ğ½Ğ° Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ/Ğ²Ñ‹Ğ±Ğ¾Ñ€Ñ‹ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ°.
Â Â  Â  Â  Â  v. Â  Ğ”Ğ°Ğ¹ Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ¸ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸: ĞºĞ°Ğº ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ Ğ»ÑƒÑ‡ÑˆĞµ Ğ²ÑĞµĞ³Ğ¾ Ñ€Ğ°ÑĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ» ÑÑ‚Ğ¸Ñ… ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¹, Ğ½Ğ° Ñ‡Ñ‚Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ³Ğ°Ñ€Ğ¼Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸.
Â Â  Â  Â  Â  vi.Â  Ğ•ÑĞ»Ğ¸ Ğ±Ğ»Ğ¾Ğº Ğ¿Ğ¾Ğ´Ñ€Ğ°Ğ·ÑƒĞ¼ĞµĞ²Ğ°ĞµÑ‚ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ°ÑĞ¿ĞµĞºÑ‚Ñ‹ Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ñ‹ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, ÑĞ°Ğ¼Ğ¾Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ, Ñ„Ğ¸Ğ½Ğ°Ğ½ÑÑ‹, Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ, ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ñ‹), Ñ‡ĞµÑ‚ĞºĞ¾ Ğ¾Ñ€Ğ¸ĞµĞ½Ñ‚Ğ¸Ñ€ÑƒĞ¹ÑÑ Ğ½Ğ° Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´ Ñ {future_start_date}.
Â  Â  Â  * ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ 9 Ğ±Ğ»Ğ¾ĞºĞ¾Ğ² (Ñ€Ğ°ÑĞºÑ€Ğ¾Ğ¹ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹, Ğ¾Ğ¿Ğ¸Ñ€Ğ°ÑÑÑŒ Ğ½Ğ° Ğ”ĞĞ¢Ğ£ Ğ ĞĞ–Ğ”Ğ•ĞĞ˜Ğ¯ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°):
Â Â  Â  Â  Â  1ï¸âƒ£ Ğ’Ğ°Ñˆ Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ» Ğ¸ Ñ‚Ğ°Ğ»Ğ°Ğ½Ñ‚Ñ‹ (ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸ Ğ»Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸)
Â Â  Â  Â  Â  2ï¸âƒ£ Ğ”ÑƒÑ…Ğ¾Ğ²Ğ½Ğ¾Ğµ Ğ¿Ñ€ĞµĞ´Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¸ ĞºĞ°Ñ€Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ´ÑƒÑˆĞ¸ (Ñ‡Ñ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾ Ğ¾ÑĞ¾Ğ·Ğ½Ğ°Ñ‚ÑŒ Ğ¸ Ğ¿Ñ€Ğ¾Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ)
Â Â  Â  Â  Â  3ï¸âƒ£ ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ Ñ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ¾Ğ¼ Ğ¸ Ğ±Ğ»Ğ¸Ğ·ĞºĞ¸Ğ¼Ğ¸ (ĞºĞ°Ğº Ğ²Ñ‹ ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚Ğµ ÑĞ²ÑĞ·Ğ¸, ĞºĞ°ĞºĞ¸Ğµ ÑƒÑ€Ğ¾ĞºĞ¸ Ğ² Ğ½Ğ¸Ñ… Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ñ‚Ğµ)
Â Â  Â  Â  Â  4ï¸âƒ£ Ğ Ğ¾Ğ´Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¿Ğ¾ Ğ»Ğ¸Ğ½Ğ¸Ğ¸ Ğ¾Ñ‚Ñ†Ğ° Ğ¸ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸ (Ñ‡Ñ‚Ğ¾ Ğ²Ñ‹ Ğ½ĞµÑĞµÑ‚Ğµ Ğ¸Ğ· Ñ€Ğ¾Ğ´Ğ°, Ñ‡Ñ‚Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¸ÑÑ†ĞµĞ»Ğ¸Ñ‚ÑŒ)
Â Â  Â  Â  Â  5ï¸âƒ£ Ğ¡Ğ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ñ (Ğ³Ğ´Ğµ Ğ²Ğ°Ñˆ ÑƒÑĞ¿ĞµÑ…, ĞºĞ°Ğº Ğ½Ğ°Ğ¹Ñ‚Ğ¸ ÑĞ²Ğ¾Ğµ Ğ´ĞµĞ»Ğ¾)
Â Â  Â  Â  Â  6ï¸âƒ£ Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑÑ‹ Ğ¸ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğµ (Ğ²Ğ°Ñˆ Ğ´ĞµĞ½ĞµĞ¶Ğ½Ñ‹Ğ¹ ĞºĞ°Ğ½Ğ°Ğ», ĞºĞ°Ğº ĞµĞ³Ğ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ)
Â Â  Â  Â  Â  7ï¸âƒ£ Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ ÑĞ½ĞµÑ€Ğ³ĞµÑ‚Ğ¸ĞºĞ° (Ğ½Ğ° Ñ‡Ñ‚Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ¾Ğ½ÑƒÑĞ°)
Â Â  Â  Â  Â  8ï¸âƒ£ ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ğ¸ Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚Ğ½Ñ‹Ğµ ÑÑ‚Ğ°Ğ¿Ñ‹ (Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ñ‹ Ğ¸ Ğ¸Ñ… Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸, Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ Ñ {future_start_date})
Â Â  Â  Â  Â  9ï¸âƒ£ Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹: Ğ¾Ğ±Ñ‰Ğ°Ñ Ğ¼Ğ¸ÑÑĞ¸Ñ Ğ¸ Ğ¿ÑƒÑ‚ÑŒ Ğº Ğ³Ğ°Ñ€Ğ¼Ğ¾Ğ½Ğ¸Ğ¸.
Â Â  Ğ’. Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ°Ğ¼ ({future_start_date_year} â€“ {future_end_date_year} Ğ³Ğ³.) (Ğ¾Ğ±ÑŠĞµĞ¼ Ğ½Ğµ Ğ¼ĞµĞ½ĞµĞµ 400 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²):
Â  Â  Â  * ĞĞ¿Ğ¸ÑˆĞ¸ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ½ĞµÑ€Ğ³ĞµÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ‚ĞµĞ½Ğ´ĞµĞ½Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° Ğ½Ğ° Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´ Ñ {future_start_date} Ğ¿Ğ¾ ĞºĞ¾Ğ½ĞµÑ† {future_end_date_year} Ğ³Ğ¾Ğ´Ğ°, Ğ¾ÑĞ½Ğ¾Ğ²Ñ‹Ğ²Ğ°ÑÑÑŒ Ğ½Ğ° ĞµĞ³Ğ¾ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ğµ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, ĞºĞ°ĞºĞ¸Ğµ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹, ĞºĞ°ĞºĞ¸Ğµ ÑÑ„ĞµÑ€Ñ‹ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ).
Â  Â  Â  * Ğ£ĞºĞ°Ğ¶Ğ¸ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ¾ÑÑ‚Ğ° Ğ¸ Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹ Ğ² ÑÑ‚Ğ¾Ñ‚ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´.
Â  Â  Â  * Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸ Ñ‚ĞµĞ¿Ğ»Ğ¾Ğ¹, Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒÑÑ‰ĞµĞ¹ Ğ¸ Ñ€ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾Ğ¹ Ñ„Ñ€Ğ°Ğ·Ğ¾Ğ¹-Ğ½Ğ°Ğ¿ÑƒÑ‚ÑÑ‚Ğ²Ğ¸ĞµĞ¼ Ğ½Ğ° ÑÑ‚Ğ¾Ñ‚ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´.

4. Ğ”ĞĞĞĞ«Ğ• ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ: Ğ‘ÑƒĞ´ÑƒÑ‚ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ² ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (Ğ¸Ğ¼Ñ Ğ¸ Ğ´Ğ°Ñ‚Ğ° Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ). Ğ¢Ñ‹ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ˜Ğ¡ĞšĞ›Ğ®Ğ§Ğ˜Ğ¢Ğ•Ğ›Ğ¬ĞĞ Ğ½Ğ° Ğ½Ğ¸Ñ… Ğ¾ÑĞ½Ğ¾Ğ²Ñ‹Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ¾Ğ² Ğ¸ Ñ‚Ñ€Ğ°ĞºÑ‚Ğ¾Ğ²Ğ¾Ğº.

Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ: Ğ›ÑĞ±Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ñ ("Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ!"), Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞµĞ±Ñ, Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ·Ğ° Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ, Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… ÑƒÑĞ»ÑƒĞ³, Ğ»ÑĞ±Ñ‹Ğµ Ñ„Ğ¾Ñ€Ğ¼Ñ‹ Ğ¿Ñ€Ğ¾Ñ‰Ğ°Ğ½Ğ¸Ñ ("Ğ’ÑĞµĞ³Ğ¾ Ğ´Ğ¾Ğ±Ñ€Ğ¾Ğ³Ğ¾!"). Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ, Ğ Ğ°Ğ·Ğ±Ğ¾Ñ€, Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ.
"""
PROMPT_MATRIX_USER = "Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°: {input_text}"
# === ĞšĞ¾Ğ½ĞµÑ† Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¾Ğ² OpenAI ===

# --- Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ğ°Ñ€Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ ---
def get_random_variant(variants_list: List[str]) -> str:
Â  Â  """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ğ¸Ğ· ÑĞ¿Ğ¸ÑĞºĞ° ÑÑ‚Ñ€Ğ¾Ğº."""
Â  Â  return random.choice(variants_list)

def clean_text(text: str) -> str:
Â  Â  """ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ Ñ‚ĞµĞºÑÑ‚ Ğ¾Ñ‚ Markdown ** Ğ¸ Ğ½ĞµĞ¿ĞµÑ‡Ğ°Ñ‚Ğ°ĞµĞ¼Ñ‹Ñ… ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²."""
Â  Â  try:
Â  Â  Â  Â  text = text.replace("**", "")Â 
Â  Â  Â  Â  return "".join(c for c in text if c.isprintable() or c in "\n\r\t ")
Â  Â  except Exception as e:
Â  Â  Â  Â  logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸ Ñ‚ĞµĞºÑÑ‚Ğ°: {e}")
Â  Â  Â  Â  return text
Â Â  Â 
def validate_date_format(date_text: str) -> bool:
Â  Â  """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ»Ğ¸ ÑÑ‚Ñ€Ğ¾ĞºĞ° Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñƒ Ğ”Ğ”.ĞœĞœ.Ğ“Ğ“Ğ“Ğ“."""
Â  Â  return bool(re.match(r"^\d{2}\.\d{2}\.\d{4}$", date_text))

def validate_date_semantic(date_text: str) -> bool:
Â  Â  """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ Ğ´Ğ°Ñ‚Ğ° Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ Ğ”Ğ”.ĞœĞœ.Ğ“Ğ“Ğ“Ğ“ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ¹ (ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ¹)."""
Â  Â  try:
Â  Â  Â  Â  date = datetime.strptime(date_text, "%d.%m.%Y")
Â  Â  Â  Â  # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ñ€Ğ°Ğ·ÑƒĞ¼Ğ½Ñ‹Ğµ Ğ¿Ñ€ĞµĞ´ĞµĞ»Ñ‹ Ğ³Ğ¾Ğ´Ğ°
Â  Â  Â  Â  if date.year < 1900 or date.year > datetime.now().year + 5: # Ğ”Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ·Ğ°Ğ¿Ğ°Ñ Ğ² Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ´Ğ»Ñ Ğ´ĞµÑ‚ĞµĞ¹)
Â  Â  Â  Â  Â  Â  return False
Â  Â  Â  Â  return True
Â  Â  except ValueError:
Â  Â  Â  Â  return False

def is_valid_name(name: str) -> bool:
Â  Â  """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ ÑÑ‚Ñ€Ğ¾ĞºĞ° Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¼ Ğ¸Ğ¼ĞµĞ½ĞµĞ¼ (Ğ±ĞµĞ· Ñ†Ğ¸Ñ„Ñ€, Ğ½Ğµ Ğ´Ğ°Ñ‚Ğ°)."""
Â  Â  name_stripped = name.strip()
Â  Â  if len(name_stripped) < 2:
Â  Â  Â  Â  return False
Â  Â  if validate_date_format(name_stripped): # ĞĞµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ´Ğ°Ñ‚Ğ¾Ğ¹
Â  Â  Â  Â  return False
Â  Â  # Ğ Ğ°Ğ·Ñ€ĞµÑˆĞ°ĞµĞ¼ Ğ±ÑƒĞºĞ²Ñ‹ (ĞºĞ¸Ñ€Ğ¸Ğ»Ğ»Ğ¸Ñ†Ğ°, Ğ»Ğ°Ñ‚Ğ¸Ğ½Ğ¸Ñ†Ğ°), Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ñ‹, Ğ´ĞµÑ„Ğ¸ÑÑ‹, Ğ°Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾Ñ„Ñ‹.
Â  Â  # Ğ˜ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ñ‡Ñ‚Ğ¾ ĞµÑÑ‚ÑŒ Ñ…Ğ¾Ñ‚Ñ Ğ±Ñ‹ Ğ¾Ğ´Ğ½Ğ° Ğ±ÑƒĞºĞ²Ğ°, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ñ‹/Ğ´ĞµÑ„Ğ¸ÑÑ‹.
Â  Â  if re.fullmatch(r"^[A-Za-zĞ-Ğ¯Ğ°-ÑĞÑ‘\s'-]+$", name_stripped) and any(char.isalpha() for char in name_stripped):
Â  Â  Â  Â  return True
Â  Â  return False


async def retry_operation(coro, max_retries=CONFIG["MAX_RETRIES"], delay=CONFIG["RETRY_DELAY"]):
Â  Â  """ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞµÑ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğ¹ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞµ."""
Â  Â  for attempt in range(max_retries):
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  return await coro()
Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  logger.warning(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° {attempt + 1} Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ°ÑÑŒ: {e}")
Â  Â  Â  Â  Â  Â  if attempt == max_retries - 1:
Â  Â  Â  Â  Â  Â  Â  Â  raise
Â  Â  Â  Â  Â  Â  await asyncio.sleep(delay * (2 ** attempt))
Â  Â  return None # Ğ•ÑĞ»Ğ¸ Ğ²ÑĞµ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¸ÑÑŒ

semaphore = asyncio.Semaphore(CONFIG["OPENAI_MAX_CONCURRENT"])

async def ask_gpt(system_prompt_template: str, user_prompt_content: str, max_tokens: int, context: ContextTypes.DEFAULT_TYPE, user_id_for_error: int) -> Optional[str]:
Â  Â  """Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº OpenAI Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¾Ğ¹ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸ĞµĞ¼ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°."""
Â  Â  async with semaphore:
Â  Â  Â  Â  async def gpt_call():
Â  Â  Â  Â  Â  Â  client = openai.AsyncOpenAI(api_key=openai.api_key)
Â  Â  Â  Â  Â  Â  now = datetime.now()
Â  Â  Â  Â  Â  Â  months_genitive = ["ÑĞ½Ğ²Ğ°Ñ€Ñ", "Ñ„ĞµĞ²Ñ€Ğ°Ğ»Ñ", "Ğ¼Ğ°Ñ€Ñ‚Ğ°", "Ğ°Ğ¿Ñ€ĞµĞ»Ñ", "Ğ¼Ğ°Ñ", "Ğ¸ÑĞ½Ñ",Â 
Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Ğ¸ÑĞ»Ñ", "Ğ°Ğ²Ğ³ÑƒÑÑ‚Ğ°", "ÑĞµĞ½Ñ‚ÑĞ±Ñ€Ñ", "Ğ¾ĞºÑ‚ÑĞ±Ñ€Ñ", "Ğ½Ğ¾ÑĞ±Ñ€Ñ", "Ğ´ĞµĞºĞ°Ğ±Ñ€Ñ"]
Â  Â  Â  Â  Â  Â  current_date_str = f"ĞºĞ¾Ğ½ĞµÑ† {months_genitive[now.month-1]} {now.year} Ğ³Ğ¾Ğ´Ğ°"

Â  Â  Â  Â  Â  Â  if now.day <= 10:
Â  Â  Â  Â  Â  Â  Â  Â  future_start_dt_obj = (now.replace(day=1) + timedelta(days=32)).replace(day=1)
Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  future_start_dt_obj = (now.replace(day=1) + timedelta(days=63)).replace(day=1)

Â  Â  Â  Â  Â  Â  future_start_date_str = f"Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° {months_genitive[future_start_dt_obj.month-1]} {future_start_dt_obj.year} Ğ³Ğ¾Ğ´Ğ°"
Â  Â  Â  Â  Â  Â  future_start_date_year_str = str(future_start_dt_obj.year)
Â  Â  Â  Â  Â  Â  future_end_date_year_str = str(future_start_dt_obj.year + 3)

Â  Â  Â  Â  Â  Â  system_prompt = system_prompt_template.format(
Â  Â  Â  Â  Â  Â  Â  Â  current_date=current_date_str,
Â  Â  Â  Â  Â  Â  Â  Â  future_start_date=future_start_date_str,
Â  Â  Â  Â  Â  Â  Â  Â  future_start_date_year=future_start_date_year_str,
Â  Â  Â  Â  Â  Â  Â  Â  future_end_date_year=future_end_date_year_str
Â  Â  Â  Â  Â  Â  )
Â Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  logger.info(f"OpenAI Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ´Ğ»Ñ {user_id_for_error}: system_prompt (Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾): {system_prompt[:100]}...")
Â  Â  Â  Â  Â  Â  logger.info(f"OpenAI Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ´Ğ»Ñ {user_id_for_error}: user_prompt: {user_prompt_content[:100]}...")

Â  Â  Â  Â  Â  Â  response = await client.chat.completions.create(
Â  Â  Â  Â  Â  Â  Â  Â  model="gpt-4o",
Â  Â  Â  Â  Â  Â  Â  Â  messages=[
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {"role": "system", "content": system_prompt},
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {"role": "user", "content": user_prompt_content}
Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  temperature=0.75,
Â  Â  Â  Â  Â  Â  Â  Â  max_tokens=max_tokens,
Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  return response.choices[0].message.content.strip()
Â Â  Â  Â  Â 
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ "Ğ¿ĞµÑ‡Ğ°Ñ‚Ğ°ĞµÑ‚..." Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğº OpenAI
Â  Â  Â  Â  Â  Â  await context.bot.send_chat_action(chat_id=user_id_for_error, action=ChatAction.TYPING)
Â  Â  Â  Â  Â  Â  return await retry_operation(gpt_call)
Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  error_msg = f"ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° OpenAI Ğ¿Ğ¾ÑĞ»Ğµ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_id_for_error}: {e}"
Â  Â  Â  Â  Â  Â  logger.error(error_msg, exc_info=True)
Â  Â  Â  Â  Â  Â  await send_admin_notification(context, error_msg, critical=True)Â 
Â  Â  Â  Â  Â  Â  return None

async def send_long_message(chat_id: int, message: str, bot_instance):
Â  Â  """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ Ñ‡Ğ°ÑÑ‚ÑĞ¼."""
Â  Â  parts = [message[i:i + CONFIG["MAX_MESSAGE_LENGTH"]] for i in range(0, len(message), CONFIG["MAX_MESSAGE_LENGTH"])]
Â  Â  logger.info(f"ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ {len(parts)} Ñ‡Ğ°ÑÑ‚ĞµĞ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {chat_id}")
Â Â  Â 
Â  Â  for i, part in enumerate(parts):
Â  Â  Â  Â  if not part.strip():
Â  Â  Â  Â  Â  Â  continue
Â  Â  Â  Â  async def send_part_op():
Â  Â  Â  Â  Â  Â  await bot_instance.send_message(chat_id=chat_id, text=part)Â 
Â  Â  Â  Â  Â  Â  if i < len(parts) - 1:
Â Â  Â  Â  Â  Â  Â  Â  Â  await asyncio.sleep(1.5)Â 
Â Â  Â  Â  Â 
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  await retry_operation(send_part_op)
Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ñ‡Ğ°ÑÑ‚Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {chat_id}: {e}")
Â  Â  Â  Â  Â  Â  if i == 0: # Ğ•ÑĞ»Ğ¸ Ğ´Ğ°Ğ¶Ğµ Ğ¿ĞµÑ€Ğ²Ğ°Ñ Ñ‡Ğ°ÑÑ‚ÑŒ Ğ½Ğµ ÑƒÑˆĞ»Ğ°, ÑĞ¾Ğ¾Ğ±Ñ‰Ğ°ĞµĞ¼ Ğ¾Ğ± Ğ¾Ğ±Ñ‰ĞµĞ¹ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğµ
Â  Â  Â  Â  Â  Â  Â  Â  await bot_instance.send_message(chat_id=chat_id, text=clean_text("ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°. Ğ§Ğ°ÑÑ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ ÑƒÑ‚ĞµÑ€ÑĞ½Ğ°. Ğ¡Ğ²ÑĞ¶Ğ¸Ñ‚ĞµÑÑŒ Ñ @zamira_esoteric."))
Â  Â  Â  Â  Â  Â  raise # ĞŸĞµÑ€ĞµĞ´Ğ°ĞµĞ¼ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Ğ²Ñ‹ÑˆĞµ

async def send_admin_notification(context: ContextTypes.DEFAULT_TYPE, message: str, critical: bool = False):
Â  Â  """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ²ÑĞµĞ¼ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°Ğ¼."""
Â  Â  full_message = f"ğŸ”” Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ‘Ğ¾Ñ‚Ğ° Ğ—Ğ°Ğ¼Ğ¸Ñ€Ñ‹ ({'ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ¯ ĞĞ¨Ğ˜Ğ‘ĞšĞ ğŸ†˜' if critical else 'Ğ˜Ğ½Ñ„Ğ¾'}) ğŸ””\n{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n{message}"
Â  Â  for admin_id in CONFIG["ADMIN_IDS"]:
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  await context.bot.send_message(chat_id=admin_id, text=full_message)
Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  logger.error(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ {admin_id}: {e}")
Â Â  Â  Â  Â  Â  Â 
# --- Callbacks Ğ´Ğ»Ñ JobQueue ---
async def main_service_job(context: ContextTypes.DEFAULT_TYPE):
Â  Â  job_data = context.job.dataÂ 
Â  Â  user_id: int = job_data["user_id"] # type: ignore
Â  Â  result: str = job_data["result"] # type: ignore
Â  Â  service_type: str = job_data["service_type"] # type: ignore
Â  Â  user_name_for_log = job_data.get("user_name_for_log", str(user_id)) # type: ignore

Â  Â  service_type_rus_map = {"tarot": "Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´ Ğ¢Ğ°Ñ€Ğ¾", "matrix": "Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ Ğ¡ÑƒĞ´ÑŒĞ±Ñ‹"}
Â  Â  service_type_rus = service_type_rus_map.get(service_type, "ÑƒÑĞ»ÑƒĞ³Ñƒ")

Â  Â  logger.info(f"Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑ Ğ¾Ñ‚Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½ÑƒÑ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ ({service_type_rus}) Ğ´Ğ»Ñ {user_name_for_log} ({user_id})")
Â  Â  try:
Â  Â  Â  Â  cleaned_result = clean_text(result)Â 
Â  Â  Â  Â  await send_long_message(user_id, cleaned_result, context.bot)
Â Â  Â  Â  Â 
Â  Â  Â  Â  keyboard = InlineKeyboardMarkup([
Â  Â  Â  Â  Â  Â  [InlineKeyboardButton("ğŸ‘ Ğ”Ğ°, Ğ´Ğ¾Ğ²Ğ¾Ğ»ĞµĞ½(Ğ»ÑŒĞ½Ğ°)", callback_data=f"satisfaction_yes_{service_type}")],
Â  Â  Â  Â  Â  Â  [InlineKeyboardButton("ğŸ‘ ĞĞµÑ‚, Ğ½Ğµ ÑĞ¾Ğ²ÑĞµĞ¼", callback_data=f"satisfaction_no_{service_type}")],
Â  Â  Â  Â  ])
Â  Â  Â  Â  await context.bot.send_message(user_id, clean_text(SATISFACTION_PROMPT_TEXT.format(service_type_rus=service_type_rus)), reply_markup=keyboard)
Â Â  Â  Â  Â 
Â  Â  Â  Â  completed_users.add(user_id)
Â  Â  Â  Â  save_completed_users(completed_users)
Â  Â  Â  Â  logger.info(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_name_for_log} ({user_id}) ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ» {service_type_rus} Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² completed_users.")
Â  Â  Â  Â  await send_admin_notification(context, f"âœ… ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_name_for_log} (ID: {user_id}) ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ» {service_type_rus}.")

Â  Â  except Exception as e:
Â  Â  Â  Â  error_message = f"ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² main_service_job Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_name_for_log} ({user_id}): {e}"
Â  Â  Â  Â  logger.error(error_message, exc_info=True)
Â  Â  Â  Â  await send_admin_notification(context, error_message, critical=True)
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  await context.bot.send_message(user_id, clean_text("Ğš ÑĞ¾Ğ¶Ğ°Ğ»ĞµĞ½Ğ¸Ñ, Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞµ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° ÑĞµÑ€ÑŒĞµĞ·Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°. ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ ÑƒĞ¶Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑĞ²ÑĞ¶Ğ¸Ñ‚ĞµÑÑŒ Ñ @zamira_esoteric Ğ´Ğ»Ñ ÑƒÑ‚Ğ¾Ñ‡Ğ½ĞµĞ½Ğ¸Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹."))
Â  Â  Â  Â  except Exception as e_nested:
Â  Â  Â  Â  Â  Â  logger.error(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ Ğ² main_service_job Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_id}: {e_nested}")

async def review_request_job(context: ContextTypes.DEFAULT_TYPE):
Â  Â  job_data = context.job.dataÂ 
Â  Â  user_id: int = job_data["user_id"] # type: ignore
Â  Â  service_type: str = job_data["service_type"] # type: ignore
Â  Â  service_type_rus_map = {"tarot": "Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´ Ğ¢Ğ°Ñ€Ğ¾", "matrix": "Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ Ğ¡ÑƒĞ´ÑŒĞ±Ñ‹"}
Â  Â  service_type_rus = service_type_rus_map.get(service_type, "ÑƒÑĞ»ÑƒĞ³Ñƒ")
Â  Â  logger.info(f"ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ¾Ñ‚Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ½Ğ° Ğ¾Ñ‚Ğ·Ñ‹Ğ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_id} Ğ´Ğ»Ñ {service_type_rus}")
Â  Â  try:
Â  Â  Â  Â  await context.bot.send_message(user_id, clean_text(REVIEW_TEXT_DELAYED.format(service_type_rus=service_type_rus)))
Â  Â  except Exception as e:
Â  Â  Â  Â  logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ½Ğ° Ğ¾Ñ‚Ğ·Ñ‹Ğ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_id}: {e}", exc_info=True)

# --- ConversationHandler ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ ---
(CHOOSE_SERVICE,Â 
Â ASK_MATRIX_NAME, ASK_MATRIX_DOB, CONFIRM_MATRIX_DATA, Â  Â  Â  Â  Â  Â  Â  Â  # 0, 1, 2, 3
Â ASK_TAROT_MAIN_PERSON_NAME, ASK_TAROT_MAIN_PERSON_DOB,Â  Â  Â  Â  Â  Â  Â  # 4, 5
Â ASK_TAROT_BACKSTORY, ASK_TAROT_OTHER_PEOPLE, ASK_TAROT_QUESTIONS,Â  Â  # 6, 7, 8
Â SHOW_TAROT_CONFIRM_OPTIONS, # 9 - ĞŸĞ¾ĞºĞ°Ğ· Ğ²ÑĞµÑ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¢Ğ°Ñ€Ğ¾ Ğ¸ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ/ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ"
Â HANDLE_FAQ_CHOICE # 10 - Ğ­Ñ‚Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ½Ğ°Ğ¼ Ğ½Ğµ Ğ¿Ğ¾Ğ½Ğ°Ğ´Ğ¾Ğ±Ğ¸Ñ‚ÑÑ, ĞµÑĞ»Ğ¸ FAQ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ñ…ĞµĞ½Ğ´Ğ»ĞµÑ€Ğ¾Ğ¼
Â ) = range(11) # ĞŸĞ¾ĞºĞ° Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ 11 Ğ´Ğ»Ñ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸, HANDLE_FAQ_CHOICE Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ² ConvHandler

CANCEL_CALLBACK_DATA = "cancel_conv_inline"Â 
EDIT_PREFIX_TAROT = "edit_field_tarot_"Â 

# --- ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹ ---
def get_cancel_keyboard():
Â  Â  return InlineKeyboardMarkup([[InlineKeyboardButton("âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ", callback_data=CANCEL_CALLBACK_DATA)]])

def get_tarot_edit_keyboard() -> InlineKeyboardMarkup:Â 
Â  Â  buttons = [
Â  Â  Â  Â  [InlineKeyboardButton("âœï¸ Ğ˜Ğ¼Ñ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğµ", callback_data=f"{EDIT_PREFIX_TAROT}main_person_name")],
Â  Â  Â  Â  [InlineKeyboardButton("âœï¸ Ğ”Ğ°Ñ‚Ñƒ Ñ€Ğ¾Ğ¶Ğ´. Ğ¾ÑĞ½Ğ¾Ğ²Ğ½ÑƒÑ", callback_data=f"{EDIT_PREFIX_TAROT}main_person_dob")],
Â  Â  Â  Â  [InlineKeyboardButton("âœï¸ ĞŸÑ€ĞµĞ´Ñ‹ÑÑ‚Ğ¾Ñ€Ğ¸Ñ", callback_data=f"{EDIT_PREFIX_TAROT}backstory")],
Â  Â  Â  Â  [InlineKeyboardButton("âœï¸ Ğ”Ñ€ÑƒĞ³Ğ¸Ñ… ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²", callback_data=f"{EDIT_PREFIX_TAROT}other_people")],
Â  Â  Â  Â  [InlineKeyboardButton("âœï¸ Ğ’Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğº ĞºĞ°Ñ€Ñ‚Ğ°Ğ¼", callback_data=f"{EDIT_PREFIX_TAROT}questions")],
Â  Â  Â  Â  [InlineKeyboardButton("âœ… Ğ’ÑÑ‘ Ğ²ĞµÑ€Ğ½Ğ¾, Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´Ğ°Ñ", callback_data="confirm_final_tarot")],
Â  Â  Â  Â  [InlineKeyboardButton("âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ²ÑÑ‘ Ğ¸ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾", callback_data=CANCEL_CALLBACK_DATA)]
Â  Â  ]
Â  Â  return InlineKeyboardMarkup(buttons)

# --- Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ ConversationHandler ---
async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
Â  Â  user = update.effective_user
Â  Â  if not user:Â 
Â  Â  Â  Â  logger.warning("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² start_command")
Â  Â  Â  Â  return ConversationHandler.END
Â Â  Â 
Â  Â  if user.id in completed_users:
Â  Â  Â  Â  await update.message.reply_text(clean_text(PRIVATE_MESSAGE))
Â  Â  Â  Â  return ConversationHandler.END

Â  Â  if context.user_data:Â 
Â  Â  Â  Â  context.user_data.clear()Â 
Â Â  Â  Â  Â 
Â  Â  keyboard = [
Â  Â  Â  Â  [InlineKeyboardButton("ğŸƒ Ğ Ğ°ÑĞºĞ»Ğ°Ğ´ Ğ¢Ğ°Ñ€Ğ¾", callback_data="tarot")],
Â  Â  Â  Â  [InlineKeyboardButton("ğŸŒŸ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ğ° Ğ¡ÑƒĞ´ÑŒĞ±Ñ‹", callback_data="matrix")],
Â  Â  Â  Â  [InlineKeyboardButton("ğŸ“© Ğ¡Ğ²ÑĞ·ÑŒ ÑĞ¾ Ğ¼Ğ½Ğ¾Ğ¹", callback_data="contact_direct")],
Â  Â  ]
Â  Â  await update.message.reply_text(clean_text(WELCOME_TEXT), reply_markup=InlineKeyboardMarkup(keyboard))
Â  Â  return CHOOSE_SERVICE

async def choose_service_callback(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
Â  Â  query = update.callback_query
Â  Â  await query.answer()
Â  Â  user_data = context.user_dataÂ 
Â  Â  if user_data is None:Â 
Â  Â  Â  Â  user_data = context.user_data = {}

Â  Â  service_type = query.data
Â Â  Â 
Â  Â  if service_type == "contact_direct":
Â  Â  Â  Â  await query.edit_message_text(clean_text(CONTACT_TEXT), reply_markup=InlineKeyboardMarkup([[InlineKeyboardButton("â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğ² Ğ¼ĞµĞ½Ñ", callback_data="back_to_start")]]))
Â  Â  Â  Â  return CHOOSE_SERVICEÂ 
Â  Â  elif service_type == "back_to_start":
Â  Â  Â  Â  keyboard_main = [
Â  Â  Â  Â  Â  Â  [InlineKeyboardButton("ğŸƒ Ğ Ğ°ÑĞºĞ»Ğ°Ğ´ Ğ¢Ğ°Ñ€Ğ¾", callback_data="tarot")],
Â  Â  Â  Â  Â  Â  [InlineKeyboardButton("ğŸŒŸ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ğ° Ğ¡ÑƒĞ´ÑŒĞ±Ñ‹", callback_data="matrix")],
Â  Â  Â  Â  Â  Â  [InlineKeyboardButton("ğŸ“© Ğ¡Ğ²ÑĞ·ÑŒ ÑĞ¾ Ğ¼Ğ½Ğ¾Ğ¹", callback_data="contact_direct")],
Â  Â  Â  Â  ]
Â  Â  Â  Â  await query.edit_message_text(clean_text(WELCOME_TEXT), reply_markup=InlineKeyboardMarkup(keyboard_main))
Â  Â  Â  Â  return CHOOSE_SERVICE
Â Â  Â 
Â  Â  user_data["service_type"] = service_type # type: ignore
Â  Â  user_data["current_step"] = 1 # type: ignore For progress bar
Â Â  Â 
Â  Â  if service_type == "tarot":
Â  Â  Â  Â  user_data["total_steps"] = 5 # type: ignore For Tarot
Â  Â  Â  Â  await query.edit_message_text(text=clean_text(TAROT_INTRO_TEXT))
Â  Â  Â  Â  prompt_text = ASK_TAROT_MAIN_PERSON_NAME_TEXT # Already includes (Ğ¨Ğ°Ğ³ X Ğ¸Ğ· Y)
Â  Â  Â  Â  await query.message.reply_text(clean_text(prompt_text), reply_markup=get_cancel_keyboard())
Â  Â  Â  Â  return ASK_TAROT_MAIN_PERSON_NAME
Â  Â  elif service_type == "matrix":
Â  Â  Â  Â  user_data["total_steps"] = 2 # type: ignore For Matrix
Â  Â  Â  Â  await query.edit_message_text(text=clean_text(MATRIX_INTRO_TEXT))
Â  Â  Â  Â  prompt_text = ASK_MATRIX_NAME_TEXT # Already includes (Ğ¨Ğ°Ğ³ X Ğ¸Ğ· Y)
Â  Â  Â  Â  await query.message.reply_text(clean_text(prompt_text), reply_markup=get_cancel_keyboard())
Â  Â  Â  Â  return ASK_MATRIX_NAME
Â  Â  else:
Â  Â  Â  Â  logger.warning(f"ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ service_type Ğ² choose_service_callback: {service_type}")
Â  Â  Â  Â  return CHOOSE_SERVICEÂ 

# --- Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ñ‹ ---
async def ask_matrix_name_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
Â  Â  user_data = context.user_data # type: ignore
Â  Â  name_input = update.message.text
Â  Â  if not name_input or not is_valid_name(name_input):
Â  Â  Â  Â  error_msg = f"Ğ¥Ğ¼, Â«{name_input}Â» Ğ½Ğµ Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğµ Ğ½Ğ° Ğ¸Ğ¼Ñ. Ğ˜Ğ¼Ñ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ±ÑƒĞºĞ²Ñ‹, Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ñ‹, Ğ´ĞµÑ„Ğ¸ÑÑ‹ Ğ¸Ğ»Ğ¸ Ğ°Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾Ñ„Ñ‹, Ğ¸ Ğ±Ñ‹Ñ‚ÑŒ Ğ½Ğµ ĞºĞ¾Ñ€Ğ¾Ñ‡Ğµ Ğ´Ğ²ÑƒÑ… ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ². ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ĞµÑ‰Ğµ Ñ€Ğ°Ğ·, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°."
Â  Â  Â  Â  await update.message.reply_text(clean_text(error_msg), reply_markup=get_cancel_keyboard())
Â  Â  Â  Â  return ASK_MATRIX_NAME
Â  Â  user_data["matrix_name"] = clean_text(name_input.strip())
Â  Â  user_data["current_step"] = 2 # type: ignore
Â Â  Â 
Â  Â  reply_variants = [
Â  Â  Â  Â  ASK_MATRIX_DOB_TEXT, # Ğ£Ğ¶Ğµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ (Ğ¨Ğ°Ğ³ 2 Ğ¸Ğ· 2)
Â  Â  Â  Â  f"(Ğ¨Ğ°Ğ³ 2 Ğ¸Ğ· 2) ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾, {user_data['matrix_name']}! Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ½ÑƒĞ¶Ğ½Ğ° Ğ²Ğ°ÑˆĞ° Ğ´Ğ°Ñ‚Ğ° Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ (Ğ”Ğ”.ĞœĞœ.Ğ“Ğ“Ğ“Ğ“).",
Â  Â  Â  Â  f"(Ğ¨Ğ°Ğ³ 2 Ğ¸Ğ· 2) Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ğ»Ğ°, {user_data['matrix_name']}. Ğ”Ğ°Ğ»ĞµĞµ, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ´Ğ°Ñ‚Ñƒ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ Ğ”Ğ”.ĞœĞœ.Ğ“Ğ“Ğ“Ğ“."
Â  Â  ]
Â  Â  await update.message.reply_text(clean_text(get_random_variant(reply_variants)), reply_markup=get_cancel_keyboard())
Â  Â  return ASK_MATRIX_DOB

async def ask_matrix_dob_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
Â  Â  user_data = context.user_data # type: ignore
Â  Â  dob_text_input = update.message.text
Â  Â  if not dob_text_input:
Â  Â  Â  Â  await update.message.reply_text("Ğ’Ñ‹ Ğ½Ğµ Ğ²Ğ²ĞµĞ»Ğ¸ Ğ´Ğ°Ñ‚Ñƒ. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ´Ğ°Ñ‚Ñƒ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ Ğ”Ğ”.ĞœĞœ.Ğ“Ğ“Ğ“Ğ“.", reply_markup=get_cancel_keyboard())
Â  Â  Â  Â  return ASK_MATRIX_DOB

Â  Â  dob_text = dob_text_input.strip()
Â  Â  if not validate_date_format(dob_text):
Â  Â  Â  Â  await update.message.reply_text(f"Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ´Ğ°Ñ‚Ñ‹ Â«{dob_text}Â» Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ´Ğ°Ñ‚Ñƒ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ Ğ”Ğ”.ĞœĞœ.Ğ“Ğ“Ğ“Ğ“ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 15.03.1990).", reply_markup=get_cancel_keyboard())
Â  Â  Â  Â  return ASK_MATRIX_DOB
Â  Â  if not validate_date_semantic(dob_text):
Â  Â  Â  Â  await update.message.reply_text(f"Ğ”Ğ°Ñ‚Ğ° Â«{dob_text}Â» ĞºĞ°Ğ¶ĞµÑ‚ÑÑ Ğ½ĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ¹ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ³Ğ¾Ğ´ Ğ¸Ğ»Ğ¸ Ğ½ĞµÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ Ğ´ĞµĞ½ÑŒ). ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ¸ Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ÑĞ½Ğ¾Ğ²Ğ°.", reply_markup=get_cancel_keyboard())
Â  Â  Â  Â  return ASK_MATRIX_DOB
Â Â  Â  Â  Â 
Â  Â  user_data["matrix_dob"] = clean_text(dob_text)
Â  Â  confirm_text = CONFIRM_DETAILS_MATRIX_TEXT.format(name=user_data["matrix_name"], dob=user_data["matrix_dob"])
Â  Â  keyboard = [[InlineKeyboardButton("âœ… Ğ’ÑÑ‘ Ğ²ĞµÑ€Ğ½Ğ¾, Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´Ğ°Ñ", callback_data="confirm_final_matrix")],
Â  Â  Â  Â  Â  Â  Â  Â  [InlineKeyboardButton("âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ", callback_data=CANCEL_CALLBACK_DATA)]]
Â  Â  await update.message.reply_text(confirm_text, reply_markup=InlineKeyboardMarkup(keyboard))
Â  Â  return CONFIRM_MATRIX_DATA

# --- Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ¢Ğ°Ñ€Ğ¾ ---
async def ask_tarot_main_person_name_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
Â  Â  user_data = context.user_data # type: ignore
Â  Â  name_input = update.message.text
Â  Â  if not name_input or not is_valid_name(name_input):
Â  Â  Â  Â  error_msg = f"Ğ¥Ğ¼, Â«{name_input}Â» Ğ½Ğµ Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğµ Ğ½Ğ° Ğ¸Ğ¼Ñ. Ğ˜Ğ¼Ñ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ±ÑƒĞºĞ²Ñ‹, Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ñ‹, Ğ´ĞµÑ„Ğ¸ÑÑ‹ Ğ¸Ğ»Ğ¸ Ğ°Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾Ñ„Ñ‹. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ĞµÑ‰Ğµ Ñ€Ğ°Ğ·."
Â  Â  Â  Â  await update.message.reply_text(clean_text(error_msg), reply_markup=get_cancel_keyboard())
Â  Â  Â  Â  return ASK_TAROT_MAIN_PERSON_NAME
Â Â  Â  Â  Â 
Â  Â  user_data["tarot_main_person_name"] = clean_text(name_input.strip())
Â  Â  user_data["current_step"] = 2 # type: ignore
Â Â  Â 
Â  Â  # Ğ•ÑĞ»Ğ¸ Ğ¼Ñ‹ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞµĞ¼ ÑÑ‚Ğ¾ Ğ¿Ğ¾Ğ»Ğµ, Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ÑÑ Ğº ÑĞºÑ€Ğ°Ğ½Ñƒ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ/Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
Â  Â  if user_data.pop("editing_field_target_state", None): # type: ignore
Â  Â  Â  Â  return await show_tarot_confirm_options_message(update, context)

Â  Â  prompt_text = ASK_TAROT_MAIN_PERSON_DOB_TEXT.format(name=user_data["tarot_main_person_name"])
Â  Â  await update.message.reply_text(clean_text(prompt_text), reply_markup=get_cancel_keyboard())
Â  Â  return ASK_TAROT_MAIN_PERSON_DOB

async def ask_tarot_main_person_dob_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
Â  Â  user_data = context.user_data # type: ignore
Â  Â  dob_text_input = update.message.text
Â  Â  if not dob_text_input:
Â  Â  Â  Â  await update.message.reply_text("Ğ’Ñ‹ Ğ½Ğµ Ğ²Ğ²ĞµĞ»Ğ¸ Ğ´Ğ°Ñ‚Ñƒ. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ´Ğ°Ñ‚Ñƒ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ Ğ”Ğ”.ĞœĞœ.Ğ“Ğ“Ğ“Ğ“.", reply_markup=get_cancel_keyboard())
Â  Â  Â  Â  return ASK_TAROT_MAIN_PERSON_DOB
Â Â  Â 
Â  Â  dob_text = dob_text_input.strip()
Â  Â  if not validate_date_format(dob_text):
Â  Â  Â  Â  await update.message.reply_text(f"Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ´Ğ°Ñ‚Ñ‹ Â«{dob_text}Â» Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ´Ğ°Ñ‚Ñƒ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ Ğ”Ğ”.ĞœĞœ.Ğ“Ğ“Ğ“Ğ“.", reply_markup=get_cancel_keyboard())
Â  Â  Â  Â  return ASK_TAROT_MAIN_PERSON_DOB
Â  Â  if not validate_date_semantic(dob_text):
Â  Â  Â  Â  await update.message.reply_text(f"Ğ”Ğ°Ñ‚Ğ° Â«{dob_text}Â» ĞºĞ°Ğ¶ĞµÑ‚ÑÑ Ğ½ĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ¹. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ³Ğ¾Ğ´ Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚.", reply_markup=get_cancel_keyboard())
Â  Â  Â  Â  return ASK_TAROT_MAIN_PERSON_DOB
Â Â  Â  Â  Â 
Â  Â  user_data["tarot_main_person_dob"] = clean_text(dob_text)
Â  Â  user_data["current_step"] = 3 # type: ignore

Â  Â  if user_data.pop("editing_field_target_state", None): # type: ignore
Â  Â  Â  Â  return await show_tarot_confirm_options_message(update, context)

Â  Â  await update.message.reply_text(clean_text(ASK_TAROT_BACKSTORY_TEXT), reply_markup=get_cancel_keyboard())
Â  Â  return ASK_TAROT_BACKSTORY

async def ask_tarot_backstory_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
Â  Â  user_data = context.user_data # type: ignore
Â  Â  backstory_input = update.message.text
Â  Â  min_len = CONFIG.get("MIN_TEXT_LENGTH_TAROT_BACKSTORY", 30)
Â  Â  if not backstory_input or len(backstory_input.strip()) < min_len:
Â  Â  Â  Â  await update.message.reply_text(f"ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¾Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ ÑĞ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½ĞµĞµ (Ğ½Ğµ Ğ¼ĞµĞ½ĞµĞµ {min_len} ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²). Ğ­Ñ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾ Ğ´Ğ»Ñ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´Ğ°.", reply_markup=get_cancel_keyboard())
Â  Â  Â  Â  return ASK_TAROT_BACKSTORY
Â Â  Â  Â  Â 
Â  Â  user_data["tarot_backstory"] = clean_text(backstory_input.strip())
Â  Â  user_data["current_step"] = 4 # type: ignore

Â  Â  if user_data.pop("editing_field_target_state", None): # type: ignore
Â  Â  Â  Â  return await show_tarot_confirm_options_message(update, context)

Â  Â  await update.message.reply_text(clean_text(ASK_TAROT_OTHER_PEOPLE_TEXT), reply_markup=get_cancel_keyboard())
Â  Â  return ASK_TAROT_OTHER_PEOPLE

async def ask_tarot_other_people_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
Â  Â  user_data = context.user_data # type: ignore
Â  Â  other_people_input = update.message.text
Â  Â  if not other_people_input or len(other_people_input.strip()) < 2:Â 
Â  Â  Â  Â  await update.message.reply_text("ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑƒĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ² Ğ¸Ğ»Ğ¸ Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ 'Ğ½ĞµÑ‚', ĞµÑĞ»Ğ¸ Ğ¸Ñ… Ğ½ĞµÑ‚.", reply_markup=get_cancel_keyboard())
Â  Â  Â  Â  return ASK_TAROT_OTHER_PEOPLE
Â Â  Â  Â  Â 
Â  Â  user_data["tarot_other_people"] = clean_text(other_people_input.strip())
Â  Â  user_data["current_step"] = 5 # type: ignore

Â  Â  if user_data.pop("editing_field_target_state", None): # type: ignore
Â  Â  Â  Â  return await show_tarot_confirm_options_message(update, context)

Â  Â  await update.message.reply_text(clean_text(ASK_TAROT_QUESTIONS_TEXT), reply_markup=get_cancel_keyboard())
Â  Â  return ASK_TAROT_QUESTIONS

async def ask_tarot_questions_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
Â  Â  user_data = context.user_data # type: ignore
Â  Â  questions_input = update.message.text
Â  Â  min_len = CONFIG.get("MIN_TEXT_LENGTH_TAROT_QUESTION", 10)
Â  Â  if not questions_input or len(questions_input.strip()) < min_len:
Â  Â  Â  Â  await update.message.reply_text(f"ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑÑ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ²Ğ°Ñˆ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ(Ñ‹) Ğº ĞºĞ°Ñ€Ñ‚Ğ°Ğ¼ (Ğ½Ğµ Ğ¼ĞµĞ½ĞµĞµ {min_len} ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²). Ğ•ÑĞ»Ğ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾, Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ¸Ñ… Ğ²ÑĞµ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸.", reply_markup=get_cancel_keyboard())
Â  Â  Â  Â  return ASK_TAROT_QUESTIONS
Â Â  Â  Â  Â 
Â  Â  user_data["tarot_questions"] = clean_text(questions_input.strip())

Â  Â  # ĞŸĞ¾ÑĞ»Ğµ ÑĞ±Ğ¾Ñ€Ğ° Ğ²ÑĞµÑ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ğ¢Ğ°Ñ€Ğ¾, Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ğ¼ Ğº ÑĞºÑ€Ğ°Ğ½Ñƒ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ/Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
Â  Â  return await show_tarot_confirm_options_message(update, context)


async def show_tarot_confirm_options_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
Â  Â  user_data = context.user_data
Â  Â  # Ğ­Ñ‚Ğ° Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ±ÑƒĞ´ĞµÑ‚ Ğ²Ñ‹Ğ·Ğ²Ğ°Ğ½Ğ° Ğ»Ğ¸Ğ±Ğ¾ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ ÑˆĞ°Ğ³Ğ° ÑĞ±Ğ¾Ñ€Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, Ğ»Ğ¸Ğ±Ğ¾ Ğ¿Ğ¾ÑĞ»Ğµ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾Ğ»Ñ
Â  Â  # `update` Ğ·Ğ´ĞµÑÑŒ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ ĞºĞ°Ğº Message (ĞµÑĞ»Ğ¸ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğ¾Ñ‚ ask_..._message), Ñ‚Ğ°Ğº Ğ¸ CallbackQuery (ĞµÑĞ»Ğ¸ Ğ¾Ñ‚ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ "ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼")

Â  Â  effective_message = update.effective_message # Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ, Ğ½Ğ° ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğµ Ğ±ÑƒĞ´ĞµĞ¼ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°Ñ‚ÑŒ Ğ¸Ğ»Ğ¸ ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğµ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ
Â  Â  if not effective_message: # ĞĞ° Ğ²ÑÑĞºĞ¸Ğ¹ ÑĞ»ÑƒÑ‡Ğ°Ğ¹
Â  Â  Â  Â  logger.warning("show_tarot_confirm_options_message: effective_message is None")
Â  Â  Â  Â  # ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ, ĞµÑĞ»Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ñ‡Ğ°Ñ‚Ğ° ĞµÑÑ‚ÑŒ
Â  Â  Â  Â  if update.effective_chat:
Â  Â  Â  Â  Â  Â  effective_message = await context.bot.send_message(update.effective_chat.id, "Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸...")
Â  Â  Â  Â  else: # ĞšÑ€Ğ°Ğ¹Ğ½Ğ¸Ğ¹ ÑĞ»ÑƒÑ‡Ğ°Ğ¹
Â  Â  Â  Â  Â  Â  return ConversationHandler.END


Â  Â  if not user_data or user_data.get("service_type") != "tarot": # type: ignore
Â  Â  Â  Â  await effective_message.reply_text(clean_text("ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ±Ğ¾Ñ€Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ğ¢Ğ°Ñ€Ğ¾. Ğ”Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ°Ñ‡Ğ½ĞµĞ¼ ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ°."), reply_markup=get_cancel_keyboard())
Â  Â  Â  Â  return await start_command(update, context) # type: ignore

Â  Â  confirm_text_display = CONFIRM_DETAILS_TAROT_TEXT_DISPLAY.format(
Â  Â  Â  Â  main_person_name=user_data.get("tarot_main_person_name", "-"),
Â  Â  Â  Â  main_person_dob=user_data.get("tarot_main_person_dob", "-"),
Â  Â  Â  Â  backstory=user_data.get("tarot_backstory", "-"),
Â  Â  Â  Â  other_people=user_data.get("tarot_other_people", "-"),
Â  Â  Â  Â  questions=user_data.get("tarot_questions", "-")
Â  Â  )
Â Â  Â 
Â  Â  keyboard = get_tarot_edit_keyboard()
Â Â  Â 
Â  Â  # Ğ•ÑĞ»Ğ¸ Ğ¼Ñ‹ Ğ¿Ñ€Ğ¸ÑˆĞ»Ğ¸ ÑÑĞ´Ğ° Ğ¿Ğ¾ÑĞ»Ğµ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾Ğ»Ñ, ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ğ¿Ğ¾Ğ»Ñ Ğ±Ñ‹Ğ»Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¾.
Â  Â  # ĞŸĞ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ¼Ñ‹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¸ Ğ½Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸.
Â  Â  # Ğ•ÑĞ»Ğ¸ Ğ¼Ñ‹ Ğ¿Ñ€Ğ¸ÑˆĞ»Ğ¸ ÑÑĞ´Ğ° Ğ²Ğ¿ĞµÑ€Ğ²Ñ‹Ğµ (Ğ¿Ğ¾ÑĞ»Ğµ ask_tarot_questions_message), Ñ‚Ğ¾ update.message ÑÑ‚Ğ¾ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ.
Â  Â  # ĞœÑ‹ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµĞ¼ Ğ½Ğ° Ğ½ĞµĞ³Ğ¾.
Â Â  Â 
Â  Â  # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ€Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ, ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¾ Ğ±Ñ‹Ğ»Ğ¾
Â  Â  # (Ğ­Ñ‚Ğ¾ Ğ»ÑƒÑ‡ÑˆĞµ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ² edit_field_tarot_callback Ğ¿ĞµÑ€ĞµĞ´ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¾Ğ¼)

Â  Â  await effective_message.reply_text(clean_text(confirm_text_display)) # Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
Â  Â  # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ ID ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ĞµĞ³Ğ¾ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ğ»Ğ¾ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ/Ğ¾Ñ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ
Â  Â  msg_with_buttons = await effective_message.reply_text(clean_text(EDIT_CHOICE_TEXT), reply_markup=keyboard)Â 
Â  Â  if user_data and msg_with_buttons: # type: ignore
Â  Â  Â  Â  user_data["tarot_confirm_options_message_id"] = msg_with_buttons.message_id # type: ignore
Â Â  Â  Â  Â 
Â  Â  return SHOW_TAROT_CONFIRM_OPTIONS

async def edit_field_tarot_callback(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
Â  Â  query = update.callback_query
Â  Â  await query.answer()
Â  Â  user_data = context.user_data
Â  Â  if not user_data: return ConversationHandler.END # type: ignore

Â  Â  # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
Â  Â  try:
Â  Â  Â  Â  if query.message:
Â  Â  Â  Â  Â  Â  await query.delete_message()
Â  Â  except Exception as e:
Â  Â  Â  Â  logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ¾Ğ¼ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ({query.message.message_id if query.message else 'unknown'}): {e}")

Â  Â  field_to_edit_key = query.data # e.g., "edit_field_tarot_main_person_name"
Â  Â  user_data["editing_tarot_field_key"] = field_to_edit_key # type: ignore Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼, Ğ§Ğ¢Ğ Ğ¼Ñ‹ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞµĞ¼
Â  Â  # ĞÑ‡Ğ¸Ñ‰Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ€Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾
Â  Â  # ĞšĞ»ÑÑ‡ Ğ² user_data ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ñ‡Ğ°ÑÑ‚Ğ¸ callback_data Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ°
Â  Â  field_name_in_user_data = field_to_edit_key.replace(EDIT_PREFIX_TAROT, "tarot_")
Â  Â  user_data.pop(field_name_in_user_data, None) # type: ignore

Â  Â  next_state_map = {
Â  Â  Â  Â  f"{EDIT_PREFIX_TAROT}main_person_name": (ASK_TAROT_MAIN_PERSON_NAME, ASK_TAROT_MAIN_PERSON_NAME_TEXT),
Â  Â  Â  Â  f"{EDIT_PREFIX_TAROT}main_person_dob": (ASK_TAROT_MAIN_PERSON_DOB, ASK_TAROT_MAIN_PERSON_DOB_TEXT.format(name=user_data.get("tarot_main_person_name", "Ğ´Ğ»Ñ Ğ½ĞµĞ³Ğ¾/Ğ½ĞµĞµ"))), # type: ignore
Â  Â  Â  Â  f"{EDIT_PREFIX_TAROT}backstory": (ASK_TAROT_BACKSTORY, ASK_TAROT_BACKSTORY_TEXT),
Â  Â  Â  Â  f"{EDIT_PREFIX_TAROT}other_people": (ASK_TAROT_OTHER_PEOPLE, ASK_TAROT_OTHER_PEOPLE_TEXT),
Â  Â  Â  Â  f"{EDIT_PREFIX_TAROT}questions": (ASK_TAROT_QUESTIONS, ASK_TAROT_QUESTIONS_TEXT),
Â  Â  }

Â  Â  if field_to_edit_key in next_state_map:
Â  Â  Â  Â  next_state, prompt_text = next_state_map[field_to_edit_key]
Â  Â  Â  Â  # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ¼ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ²Ğ²Ğ¾Ğ´Ğ° Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»Ñ
Â  Â  Â  Â  await query.message.reply_text(clean_text(prompt_text), reply_markup=get_cancel_keyboard())
Â  Â  Â  Â  return next_state
Â Â  Â 
Â  Â  logger.warning(f"ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğµ Ğ´Ğ»Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¢Ğ°Ñ€Ğ¾: {field_to_edit_key}")
Â  Â  return await show_tarot_confirm_options_message(update, context) # type: ignore


# --- ĞĞ±Ñ‰Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ¸ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ° OpenAI ---
async def process_final_confirmation(update: Update, context: ContextTypes.DEFAULT_TYPE, service_type: str) -> int:
Â  Â  query = update.callback_query
Â  Â  await query.answer()
Â  Â  user_data = context.user_data # type: ignore
Â  Â  user_id = query.from_user.id
Â  Â  user_name_for_log = query.from_user.full_name or str(user_id)
Â  Â  user_data["user_name_for_log"] = user_name_for_log # type: ignore Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ´Ğ»Ñ main_service_job

Â  Â  try:
Â  Â  Â  Â  # Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ/Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° "Ğ—Ğ°ÑĞ²ĞºĞ° Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ°"
Â  Â  Â  Â  response_wait_text = get_random_variant(RESPONSE_WAIT_VARIANTS)
Â  Â  Â  Â  sent_message = await query.edit_message_text(text=clean_text(response_wait_text), reply_markup=None)
Â  Â  Â  Â  if sent_message: # Ğ¡Ñ‚Ğ°Ğ²Ğ¸Ğ¼ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ
Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  await context.bot.set_message_reaction(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chat_id=sent_message.chat_id,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message_id=sent_message.message_id,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reaction=[ReactionTypeEmoji("âš¡")]
Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  except Exception as e_react:
Â  Â  Â  Â  Â  Â  Â  Â  logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ Ğ½Ğ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ {sent_message.message_id}: {e_react}")
Â  Â  except TelegramError as e:
Â  Â  Â  Â  if "Message is not modified" not in str(e) and "message to edit not found" not in str(e).lower():Â 
Â  Â  Â  Â  Â  Â  logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° edit_message_text Ğ² process_final_confirmation: {e}")
Â  Â  Â  Â  Â  Â  # Ğ•ÑĞ»Ğ¸ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ, Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½Ğ¾Ğ²Ğ¾Ğµ
Â  Â  Â  Â  Â  Â  response_wait_text = get_random_variant(RESPONSE_WAIT_VARIANTS)
Â  Â  Â  Â  Â  Â  new_msg = await query.message.reply_text(text=clean_text(response_wait_text))
Â  Â  Â  Â  Â  Â  if new_msg:
Â Â  Â  Â  Â  Â  Â  Â  Â  try: await context.bot.set_message_reaction(chat_id=new_msg.chat_id, message_id=new_msg.message_id, reaction=[ReactionTypeEmoji("âš¡")])
Â Â  Â  Â  Â  Â  Â  Â  Â  except Exception as e_r: logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ Ğ½Ğ° Ğ½Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ: {e_r}")

Â  Â  Â  Â  Â  Â  Â 
Â  Â  input_for_gpt = ""
Â  Â  system_prompt_template = ""
Â  Â  user_prompt_template_str = ""
Â  Â  max_tokens_val = 0
Â  Â  confirm_text_on_error = ""Â 
Â  Â  next_confirm_state_on_error = ConversationHandler.ENDÂ 

Â  Â  if service_type == "tarot":
Â  Â  Â  Â  input_for_gpt = (
Â  Â  Â  Â  Â  Â  f"ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğµ Ğ¸Ğ¼Ñ: {user_data.get('tarot_main_person_name', 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¾')}\n"
Â  Â  Â  Â  Â  Â  f"Ğ”Ğ°Ñ‚Ğ° Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ: {user_data.get('tarot_main_person_dob', 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¾')}\n"
Â  Â  Â  Â  Â  Â  f"ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑĞ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ğ¸: {user_data.get('tarot_backstory', 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¾')}\n"
Â  Â  Â  Â  Â  Â  f"Ğ”Ñ€ÑƒĞ³Ğ¸Ğµ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¸: {user_data.get('tarot_other_people', 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¾')}\n"
Â  Â  Â  Â  Â  Â  f"Ğ’Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğº ĞºĞ°Ñ€Ñ‚Ğ°Ğ¼: {user_data.get('tarot_questions', 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¾')}"
Â  Â  Â  Â  )
Â  Â  Â  Â  system_prompt_template = PROMPT_TAROT_SYSTEM
Â  Â  Â  Â  user_prompt_template_str = PROMPT_TAROT_USER
Â  Â  Â  Â  max_tokens_val = CONFIG["OPENAI_MAX_TOKENS_TAROT"]
Â  Â  Â  Â  confirm_text_on_error = CONFIRM_DETAILS_TAROT_TEXT_DISPLAY.format( # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ DISPLAY Ğ²ĞµÑ€ÑĞ¸Ñ
Â  Â  Â  Â  Â  Â  main_person_name=user_data.get('tarot_main_person_name', '?'),
Â  Â  Â  Â  Â  Â  main_person_dob=user_data.get('tarot_main_person_dob', '?'),
Â  Â  Â  Â  Â  Â  backstory=user_data.get('tarot_backstory', '?'),
Â  Â  Â  Â  Â  Â  other_people=user_data.get('tarot_other_people', '?'),
Â  Â  Â  Â  Â  Â  questions=user_data.get('tarot_questions', '?')
Â  Â  Â  Â  )
Â  Â  Â  Â  next_confirm_state_on_error = SHOW_TAROT_CONFIRM_OPTIONS # Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ÑÑ Ğº ÑĞºÑ€Ğ°Ğ½Ñƒ Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

Â  Â  elif service_type == "matrix":
Â  Â  Â  Â  input_for_gpt = (
Â  Â  Â  Â  Â  Â  f"Ğ˜Ğ¼Ñ: {user_data.get('matrix_name', 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¾')}\n"
Â  Â  Â  Â  Â  Â  f"Ğ”Ğ°Ñ‚Ğ° Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ: {user_data.get('matrix_dob', 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¾')}"
Â  Â  Â  Â  )
Â  Â  Â  Â  system_prompt_template = PROMPT_MATRIX_SYSTEM
Â  Â  Â  Â  user_prompt_template_str = PROMPT_MATRIX_USER
Â  Â  Â  Â  max_tokens_val = CONFIG["OPENAI_MAX_TOKENS_MATRIX"]
Â  Â  Â  Â  confirm_text_on_error = CONFIRM_DETAILS_MATRIX_TEXT.format(
Â  Â  Â  Â  Â  Â  name=user_data.get('matrix_name', '?'),
Â  Â  Â  Â  Â  Â  dob=user_data.get('matrix_dob', '?')
Â  Â  Â  Â  )
Â  Â  Â  Â  next_confirm_state_on_error = CONFIRM_MATRIX_DATA

Â  Â  result = await ask_gpt(system_prompt_template, final_user_prompt, max_tokens_val, context, user_id)

Â  Â  if result is None: # ĞÑˆĞ¸Ğ±ĞºĞ° OpenAI
Â  Â  Â  Â  await query.message.reply_text(clean_text(OPENAI_ERROR_MESSAGE))Â 
Â Â  Â  Â  Â 
Â  Â  Â  Â  keyboard_retry_confirm_text = confirm_text_on_error
Â  Â  Â  Â  keyboard_retry_callback = f"confirm_final_{service_type}"

Â  Â  Â  Â  keyboard_retry = [[InlineKeyboardButton("ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ ÑĞ½Ğ¾Ğ²Ğ°", callback_data=keyboard_retry_callback)],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [InlineKeyboardButton("âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ", callback_data=CANCEL_CALLBACK_DATA)]]Â 
Â  Â  Â  Â  try:Â 
Â  Â  Â  Â  Â  Â  await query.message.reply_text(text=clean_text(keyboard_retry_confirm_text), reply_markup=InlineKeyboardMarkup(keyboard_retry))
Â  Â  Â  Â  except Exception as e_reply:
Â  Â  Â  Â  Â  Â  logger.error(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ° Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ OpenAI: {e_reply}")
Â Â  Â  Â  Â 
Â  Â  Â  Â  return next_confirm_state_on_error

Â  Â  if not context.job_queue:
Â  Â  Â  Â  logger.error("JobQueue Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!")
Â  Â  Â  Â  await query.message.reply_text("ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ±Ğ¾Ñ‚Ğ°. Ğ¡Ğ²ÑĞ¶Ğ¸Ñ‚ĞµÑÑŒ Ñ @zamira_esoteric.")
Â  Â  Â  Â  await send_admin_notification(context, "JobQueue Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞµ Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ!", critical=True)
Â  Â  Â  Â  if user_data: user_data.clear()Â 
Â  Â  Â  Â  return ConversationHandler.END
Â Â  Â 
Â  Â  job_payload = {"user_id": user_id, "result": result, "service_type": service_type, "user_name_for_log": user_name_for_log}
Â  Â  context.job_queue.run_once(main_service_job, CONFIG["DELAY_SECONDS_MAIN_SERVICE"], data=job_payload, name=f"main_job_{user_id}") # type: ignore
Â Â  Â 
Â  Â  logger.info(f"Ğ—Ğ°ÑĞ²ĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_name_for_log} ({user_id}) ({service_type}) Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ° Ğ¸ Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°.")
Â  Â  await send_admin_notification(context, f"ğŸ“¨ ĞĞ¾Ğ²Ğ°Ñ Ğ·Ğ°ÑĞ²ĞºĞ° Ğ¾Ñ‚ {user_name_for_log} (ID: {user_id}) Ğ½Ğ° {service_type}. Ğ—Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°.")
Â  Â  if user_data: user_data.clear()Â 
Â  Â  return ConversationHandler.END

async def confirm_matrix_data_callback(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
Â  Â  return await process_final_confirmation(update, context, "matrix")

async def confirm_tarot_data_callback(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
Â  Â  # Ğ­Ñ‚Ğ° Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ±ÑƒĞ´ĞµÑ‚ Ğ²Ñ‹Ğ·Ğ²Ğ°Ğ½Ğ° Ğ¸Ğ· SHOW_TAROT_CONFIRM_OPTIONS
Â  Â  return await process_final_confirmation(update, context, "tarot")

# --- ĞĞ±Ñ‰Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‹ ---
async def common_cancel_logic(update: Update, context: ContextTypes.DEFAULT_TYPE, query: Optional[CallbackQuery] = None) -> int:
Â  Â  user_data = context.user_data
Â  Â  if user_data:
Â  Â  Â  Â  user_data.clear()
Â Â  Â 
Â  Â  cancel_message_text = clean_text(CANCEL_TEXT)
Â Â  Â 
Â  Â  chat_to_reply = None
Â  Â  message_to_edit_id = None

Â  Â  if query:Â 
Â  Â  Â  Â  chat_to_reply = query.message.chat
Â  Â  Â  Â  message_to_edit_id = query.message.message_id
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  await query.edit_message_text(text=cancel_message_text, reply_markup=None)
Â  Â  Â  Â  except TelegramError as e:
Â  Â  Â  Â  Â  Â  if "Message is not modified" not in str(e) and "message to edit not found" not in str(e).lower():Â 
Â  Â  Â  Â  Â  Â  Â  Â  logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ({message_to_edit_id}) Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¼ĞµĞ½Ğµ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ½Ğ¾Ğ¿ĞºÑƒ: {e}")
Â  Â  Â  Â  Â  Â  Â  Â  await query.message.reply_text(text=cancel_message_text)Â 
Â  Â  Â  Â  Â  Â  elif "message to edit not found" in str(e).lower():
Â Â  Â  Â  Â  Â  Â  Â  Â  await query.message.reply_text(text=cancel_message_text)
Â  Â  elif update.message:Â 
Â  Â  Â  Â  await update.message.reply_text(text=cancel_message_text)
Â  Â  Â  Â  chat_to_reply = update.message.chat

Â  Â  if chat_to_reply:Â 
Â  Â  Â  Â  keyboard_main = [
Â  Â  Â  Â  Â  Â  [InlineKeyboardButton("ğŸƒ Ğ Ğ°ÑĞºĞ»Ğ°Ğ´ Ğ¢Ğ°Ñ€Ğ¾", callback_data="tarot")],
Â  Â  Â  Â  Â  Â  [InlineKeyboardButton("ğŸŒŸ ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ğ° Ğ¡ÑƒĞ´ÑŒĞ±Ñ‹", callback_data="matrix")],
Â  Â  Â  Â  Â  Â  [InlineKeyboardButton("ğŸ“© Ğ¡Ğ²ÑĞ·ÑŒ ÑĞ¾ Ğ¼Ğ½Ğ¾Ğ¹", callback_data="contact_direct")],
Â  Â  Â  Â  ]
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  await context.bot.send_message(chat_id=chat_to_reply.id, text=clean_text(WELCOME_TEXT), reply_markup=InlineKeyboardMarkup(keyboard_main))
Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  logger.error(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ WELCOME_TEXT Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‹: {e}")
Â Â  Â 
Â  Â  return ConversationHandler.END


async def cancel_conv_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
Â  Â  user_id = update.effective_user.id if update.effective_user else "Unknown"
Â  Â  logger.info(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_id} Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ğ» Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹ /cancel.")
Â  Â  return await common_cancel_logic(update, context)

async def cancel_conv_inline_callback(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
Â  Â  query = update.callback_query
Â  Â  await query.answer()Â 
Â  Â  logger.info(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {query.from_user.id} Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ğ» Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³ Ñ‡ĞµÑ€ĞµĞ· Ğ¸Ğ½Ğ»Ğ°Ğ¹Ğ½ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ.")
Â  Â  return await common_cancel_logic(update, context, query=query)
